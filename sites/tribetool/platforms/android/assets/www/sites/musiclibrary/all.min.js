!function(){{var a=angular.element("*[ng-app]").injector();a.get("OPTIONS")}angular.module("dmusiclibrary",["Scope.safeApply","angularFretboard"]).config(["$locationProvider",function(){}]),angular.module("dmusiclibrary.Controllers",[]),angular.module("dmusiclibrary.Directives",[]),angular.module("dmusiclibrary.Services",[]);var b=a.get("communityService"),c=[];b.loadCommunityScripts({community:{Url:"musiclibrary"},files:["sites/musiclibrary/vendor/angular/safeApply.js","sites/musiclibrary/vendor/canvg/rgbcolor.js","sites/musiclibrary/vendor/canvg/canvg.js","sites/musiclibrary/vendor/fretboard-js/raphael-min.js","sites/musiclibrary/vendor/Vex/vexchords/js/chart.js","sites/musiclibrary/vendor/Vex/vexchords/js/chord.js","sites/musiclibrary/vendor/Vex/vexflow/src/vex.js","sites/musiclibrary/vendor/Vex/vexflow/src/flow.js","sites/musiclibrary/vendor/Vex/vexflow/src/canvascontext.js","sites/musiclibrary/vendor/Vex/vexflow/src/raphaelcontext.js","sites/musiclibrary/vendor/Vex/vexflow/src/tickcontext.js","sites/musiclibrary/vendor/Vex/vexflow/src/modifiercontext.js","sites/musiclibrary/vendor/Vex/vexflow/src/renderer.js","sites/musiclibrary/vendor/Vex/vexflow/src/fraction.js","sites/musiclibrary/vendor/Vex/vexflow/src/tickable.js","sites/musiclibrary/vendor/Vex/vexflow/src/tables.js","sites/musiclibrary/vendor/Vex/vexflow/src/note.js","sites/musiclibrary/vendor/Vex/vexflow/src/stem.js","sites/musiclibrary/vendor/Vex/vexflow/src/stemmablenote.js","sites/musiclibrary/vendor/Vex/vexflow/src/modifier.js","sites/musiclibrary/vendor/Vex/vexflow/src/accidental.js","sites/musiclibrary/vendor/Vex/vexflow/src/dot.js","sites/musiclibrary/vendor/Vex/vexflow/src/notehead.js","sites/musiclibrary/vendor/Vex/vexflow/src/boundingbox.js","sites/musiclibrary/vendor/Vex/vexflow/src/beam.js","sites/musiclibrary/vendor/Vex/vexflow/src/stavetie.js","sites/musiclibrary/vendor/Vex/vexflow/src/stavenote.js","sites/musiclibrary/vendor/Vex/vexflow/src/formatter.js","sites/musiclibrary/vendor/Vex/vexflow/src/stavemodifier.js","sites/musiclibrary/vendor/Vex/vexflow/src/stavebarline.js","sites/musiclibrary/vendor/Vex/vexflow/src/timesignature.js","sites/musiclibrary/vendor/Vex/vexflow/src/stave.js","sites/musiclibrary/vendor/Vex/vexflow/src/keysignature.js","sites/musiclibrary/vendor/Vex/vexflow/src/textnote.js","sites/musiclibrary/vendor/Vex/vexflow/src/stavetext.js","sites/musiclibrary/vendor/Vex/vexflow/src/clef.js","sites/musiclibrary/vendor/Vex/vexflow/src/fonts/vexflow_font.js","sites/musiclibrary/vendor/Vex/vexflow/src/glyph.js","sites/musiclibrary/vendor/Vex/vexflow/src/tabstave.js","sites/musiclibrary/vendor/Vex/vexflow/src/tabnote.js","sites/musiclibrary/vendor/Vex/vexflow/src/modifier.js","sites/musiclibrary/vendor/Vex/vexflow/src/bend.js","sites/musiclibrary/vendor/Vex/vexflow/src/vibrato.js","sites/musiclibrary/vendor/Vex/vexflow/src/voice.js","sites/musiclibrary/vendor/Vex/vexflow/src/tuplet.js","sites/musiclibrary/vendor/Vex/vexflow-addendum/notehighlight.js","sites/musiclibrary/vendor/Vex/vexflow-addendum/noteselection.js","sites/musiclibrary/vendor/Vex/vexflow-addendum/notesection.js","sites/musiclibrary/vendor/Vex/vexflow-addendum/notetext.js","sites/musiclibrary/vendor/midi/js/MIDI/AudioDetect.js","sites/musiclibrary/vendor/midi/js/MIDI/LoadPlugin.js","sites/musiclibrary/vendor/midi/js/MIDI/Plugin.js","sites/musiclibrary/vendor/midi/js/MIDI/Player.js","sites/musiclibrary/vendor/midi/js/Window/DOMLoader.XMLHttp.js","sites/musiclibrary/vendor/midi/inc/Base64.js","sites/musiclibrary/vendor/midi/inc/base64binary.js","sites/musiclibrary/vendor/fretboard-js/fretboard.js","sites/musiclibrary/vendor/fretboard-js/safeApply.js","sites/musiclibrary/vendor/fretboard-js/angular-fretboard.js","sites/musiclibrary/controllers/homeControllers.js","sites/musiclibrary/services/commServices.js","sites/musiclibrary/services/bazzleServices.js","sites/musiclibrary/services/virtualCowriterServices.js","sites/musiclibrary/services/instrumentServices.js","sites/musiclibrary/services/notationServices.js","sites/musiclibrary/services/midiServices.js","sites/musiclibrary/services/chordServices.js","sites/musiclibrary/services/scaleServices.js","sites/musiclibrary/services/fretboardJsServices.js","sites/musiclibrary/services/navigationServices.js","sites/musiclibrary/services/chord-progressions/chordGridServices.js","sites/musiclibrary/services/chord-progressions/chordProgressionGeneratorServices.js","sites/musiclibrary/directives/bazzleDirectives.js","sites/musiclibrary/directives/instrumentDirectives.js","sites/musiclibrary/directives/virtualCowriterDirectives.js","sites/musiclibrary/directives/midiDirectives.js","sites/musiclibrary/directives/toolDirectives.js","sites/musiclibrary/directives/navigationDirectives.js","sites/musiclibrary/directives/notationDirectives.js","sites/musiclibrary/directives/chord-progressions/chord-grid.js","sites/musiclibrary/directives/chord-progressions/chordProgressionGeneratorDirectives.js"],dependencyCommunities:c})}(),angular.module("dmusiclibrary.Controllers").controller("dmusiclibraryHomeController",["$rootScope","$scope","navigationService",function(a,b){b.initialized=function(){}}]),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryBazzle",["navigationService","communityService","dmusiclibraryNavigationService",function(a,b,c){return{restrict:"E",replace:"true",transclude:!0,templateUrl:"/sites/musiclibrary/app-templates/bazzle.html",scope:{},controller:["$rootScope","$scope","marketingService","commService","metaService","OPTIONS","dmusiclibraryBazzleService","dmusiclibraryInstrumentService","dmusiclibraryMidiService","$location","$routeParams",function(b,d,e,f,g,h,i,j){d.form={command:i.lastCommand?i.lastCommand:"Am7 to tab using frets 3 to 8"},d.execute=function(){i.executeAndSetScopeResults(d)},d.OPTIONS=h,window.prerenderReady=!1;var k=function(){d.form.command=i.lastCommand?i.lastCommand:"Am7 to tab using frets 3 to 8";var b=c.getCommandFromRoute(),e=c.getInstrumentFromRoute();d.showExamples=!1,d.results=null,d.excludedFormulas=null,e||(e=JSON.stringify(j.instrument)),d.isInstrumentJson=j.isInstrumentJson(e);var h=!0;if(b){b=b.replace(new RegExp("-","g")," "),d.form.command=b,window.prerenderReady=!1;var k=b.split(" "),l="";l=d.isInstrumentJson?j.getShortNameOfCurrentInstrument():e,k.length>0&&"TAB"===k[k.length-1].toUpperCase()&&(k[k.length-1]="Chord",k.push("Chart")),k.push("-"),k.push(l);for(var m=0;m<k.length;m++){var n=k[m];n.length>0&&(k[m]=n.charAt(0).toUpperCase()+n.slice(1))}var o=k.join(" ");g.setTitle(o+" | Songwriting Search Engine - Bazzle"),g.setDescription("Songwriting Theory Search Engine results for: '"+o+"'")}else window.prerenderReady=!0;d.isInstrumentJson||h?d.isInstrumentJson:a.clearUrlParams(),d.isInstrumentJson||(f.showWarningAlert("Your instrument is being changed to "+e+".",{onlyIfUnique:!0}),j.setInstrumentFromName(e,function(){d.execute()},function(){})),b&&(d.form.command=b,i.lastCommand=d.form.command,d.isInstrumentJson&&d.execute())};j.initialized?k():d.$on("instrumentServiceInitialized",function(){k()}),d.$on("$routeChangeSuccess",function(){k()})}],link:function(c){c.goToTools=function(){a.goToTool(b.community)}}}}]).directive("dmusiclibraryResultsPanel",[function(){return{restrict:"AE",replace:"true",transclude:!0,template:'<div><dmusiclibrary-selection-panel></dmusiclibrary-selection-panel><a id="results"></a><div ng-repeat="result in results"><dmusiclibrary-result-panel result="result" result-index="$index"></dmusiclibrary-result-panel></div></div>',scope:{results:"="},link:function(){}}}]).directive("dmusiclibraryResultPanel",["dmusiclibraryNavigationService",function(a){return{restrict:"AE",replace:"true",transclude:!0,template:'<div><accordion ><accordion-group is-open="true" style="background-color: #f5f5f5"><accordion-heading style="background-color: #e3e3e3;"><div style="color: blue;"><span ng-show="!result.Title.Command">{{result.Title.Text}}</span><span ng-show="result.Title.Command"><a ng-click="goToBazzle(result.Title.Command)" class="pointer">{{pane.Title.Text}}</a></span><div ng-show="result.Panes != null && result.Panes.length > 0 && result.AllErrors" class="pull-right error-notification" ua-toggle-class="error-notification-initial,error-notification-highlighted-initial" interval="550"  max-cycles="2">{{result.Panes.length}}</div><div ng-show="result.Panes != null && result.Panes.length > 0 && !result.AllErrors" class="pull-right notification" ua-toggle-class="notification-initial,notification-highlighted-initial" interval="550"  max-cycles="2">{{result.Panes.length}}</div></div></accordion-heading><dmusiclibrary-doubt-panel result="result"></dmusiclibrary-doubt-panel><div class="row"><dmusiclibrary-filters-panel result="result" result-index="resultIndex"></dmusiclibrary-filters-panel></div><div ng-repeat="row in result.rows" ><div ng-repeat="smallPanel in row" ng-class="{\'col-sm-6\' : (smallPanel.Size === \'Large\'), \'col-sm-3\' : (smallPanel.Size === \'Small\'), \'col-sm-4\' : (smallPanel.Size === \'Medium\')}"><dmusiclibrary-command-small-panel result-index="resultIndex" small-panel="smallPanel" index="$index"></dmusiclibrary-command-small-panel></div></div><div class="row" style="clear: both;"><dmusiclibrary-input-assumptions-panel result="result"></dmusiclibrary-input-assumptions-panel><dmusiclibrary-parameter-assumptions-panel result="result"></dmusiclibrary-parameter-assumptions-panel></div></accordion-group></accordion></div>',scope:{result:"=",resultIndex:"=",index:"="},link:function(b){b.goToBazzle=function(b){a.goToBazzle(b,null)}}}}]).directive("dmusiclibraryCommandSmallPanel",["dmusiclibraryNavigationService","dmusiclibraryBazzleService","$rootScope",function(a,b,c){return{restrict:"E",replace:"true",transclude:!0,template:'<div ng-show="showContents" style="text-align: center; position: relative;"  ng-class="{\'small-panel\' : smallPanel.Success, \'alert alert-danger\' : !smallPanel.Success}" class="dropdown" dropdown><a href ng-if="smallPanel.Success" class="dropdown-toggle pointer" dropdown-toggle ng-click="settingsClicked()"><i class="fa fa-ellipsis-v small-pane-settings"></i></a><ul ng-if="smallPanel.Success" ng-show="options.showOptions" class="small-pane-settings-menu dropdown-menu"><li><a href="" ng-click="toggleSelectMultiple()" class="pointer">{{options.toggleSelectMultipleText}}</a></li><li ng-show="options.isSelecting && textElementCommands" class="divider"></li><li ng-if="options.isSelecting" ng-repeat="textElementCommand in textElementCommands"><a href="" ng-click="executeTextElementCommand(textElementCommand)" class="pointer">{{textElementCommand.text}}</a></li><li ng-show="!options.isSelecting && smallPanel.Commands" class="divider"></li><li ng-if="!options.isSelecting && smallPanel.Commands" ng-repeat="smallPanelCommand in smallPanel.Commands"><a href="" ng-click="executeSmallPanelCommand(smallPanelCommand)" class="pointer">{{smallPanelCommand.Text}}</a></li><li class="divider"></li><li ng-if="smallPanel.FilterableProperties" ng-repeat="filterableProperty in smallPanel.FilterableProperties"><a href="" ng-click="filterByFilterableProperty(filterableProperty)" class="pointer">Filter All By \'{{filterableProperty.FilterValue}}\'</a></li><li ng-if="hasFilters"><a href="" ng-click="clearAllFilters()" class="pointer"><span class="glyphicon glyphicon-remove"></span> Clear All Filters</a></li><li ng-if="hasFilters || smallPanel.FilterableProperties" class="divider"></li><li><a href="" class="pointer">Help <span class="menu-explanation">(What\'s going on?)</span></a></li></ul><dmusiclibrary-text-element result-index="resultIndex" text-element="smallPanel.Content"></dmusiclibrary-text-element></div>',scope:{smallPanel:"=",index:"=",resultIndex:"="},link:function(d){d.showContents=!0,d.hasFilters=!1;var e=b.results[d.resultIndex];if(e.Filters&&e.Filters.length>0){d.hasFilters=!0;var f=function(a,b){var e={filterName:a,filterValue:b,resultIndex:d.resultIndex};c.$broadcast("filterAppliedFromPanelSettings",e),c.$emit("filterAppliedFromPanelSettings",e),navigationService.goToResults()};d.clearAllFilters=function(){b.clearAllFilters(d.resultIndex);for(var a=0;a<e.Filters.length;a++){var c=e.Filters[a];f(c.FilterName,null)}},d.smallPanel.FilterableProperties&&(d.filterByFilterableProperty=function(a){f(a.FilterName,a.FilterValue)})}b.subscribeAndHandleFilters(d.smallPanel.FilterableProperties,d.resultIndex,function(){d.showContents=!0},function(){d.showContents=!1}),d.options={showOptions:!1,isSelecting:!1,toggleSelectMultipleText:""},d.goToBazzle=function(b){a.goToBazzle(b)},d.settingsClicked=function(){d.options.showOptions=!0},d.toggleSelectMultiple=function(){b.toggleSelecting()},d.executeSmallPanelCommand=function(a){d.goToBazzle(a.Command)},d.executeTextElementCommand=function(a){return b.executeTextElementCommand(a)};var g=function(){d.options.toggleSelectMultipleText=d.options.isSelecting?"Stop Selecting Multiple":"Select Multiple"};g(),d.smallPanel.Success&&b.registerTextElementCallback(function(){d.options.isSelecting=b.selectionOptions.isSelecting,g(),d.options.isSelecting&&(d.textElementCommands=b.getTextElementCommandsForSelectedTextElement())})}}}]).directive("dmusiclibraryTextElementContent",["RecursionHelper",function(a){return{restrict:"E",replace:"true",transclude:!0,template:'<div><div ng-repeat="textElement in content"><dmusiclibrary-text-element result-index="resultIndex" text-element="textElement"></dmusiclibrary-text-element></div></div>',scope:{content:"=",resultIndex:"="},compile:function(b){return a.compile(b)}}}]).directive("dmusiclibrarySelectionPanel",["dmusiclibraryBazzleService","navigationService",function(a){return{restrict:"E",replace:"true",transclude:!0,template:'<div id="selection-panel" class="panel panel-primary col-sm-12" ng-show="showPanel"><a id="selection-panel-anchor"></a><div class="panel-heading"><h3 class="panel-title">Options for Current Selection</h3></div><div class="panel-body"><div ng-show="selectedTextElement"><div ng-show="textElementsText != \'\'" style="padding-bottom: 20px;">View <b>{{textElementsText}}</b></div><button ng-repeat="textElementCommand in textElementCommands" ng-click="executeTextElementCommand(textElementCommand)" class="btn btn-success" style="margin-right: 20px;">{{textElementCommand.text}}</button></div><div ng-show="!selectedTextElement"><h3>Nothing has been selected yet.</h3><h5>Check a few boxes below then come back here for more options.</h5></div><div style="margin-top: 20px;"><button class="btn btn-danger pull-right" style="margin-left: 20px;" ng-click="clear()"><span class="glyphicon glyphicon-remove"></span> Stop Selecting Multiple</button></div></div></div>',scope:{},link:function(b){b.showPanel=!1,b.selectedTextElement=null,b.textElementsText="",a.registerCallback(function(){if(b.showPanel=a.selectionOptions.isSelecting,b.showPanel){if(b.selectedTextElement=a.getRootSelectedTextElement(),b.textElementsText="",b.selectedTextElement)for(var c=0;c<a.selectionOptions.selectedTextElements.length;c++){var d=a.selectionOptions.selectedTextElements[c];b.textElementsText+='"'+a.getTextFromTextElement(d)+'"',c+1<a.selectionOptions.selectedTextElements.length&&(b.textElementsText+=", ")}b.textElementCommands=a.getTextElementCommandsForSelectedTextElement()}}),b.clear=function(){a.clearSelection()},b.executeTextElementCommand=function(b){return a.executeTextElementCommand(b)}}}}]).directive("dmusiclibraryTextElementText",["RecursionHelper","dmusiclibraryNavigationService","dmusiclibraryBazzleService",function(a,b,c){return{restrict:"E",replace:"true",transclude:!0,template:'<span ng-style="{\'font-weight\': textElement.IsBold ? \'bolder\' : \'normal\'}"><span ng-if="textElement.ObjectType!==\'Text\'"><dmusiclibrary-chord-chart ng-if="textElement.ObjectType===\'TabChart\'" chord-chart="textElement.Object"></dmusiclibrary-chord-chart><dmusiclibrary-tab-staff ng-if="textElement.ObjectType===\'TabStaff\'" tab-staff="textElement.Object"></dmusiclibrary-tab-staff><dmusiclibrary-bazzle-staff-result ng-if="textElement.ObjectType===\'Staff\'" staff="textElement.Object"></dmusiclibrary-bazzle-staff-result><dmusiclibrary-text-element-html ng-if="textElement.ObjectType===\'Html\'" html-string="textElement.Object"></dmusiclibrary-text-element-html></span><span ng-if="textExists"><input ng-if="options.isSelectable" ng-show="options.isSelecting" ng-model="options.isSelected" type="checkbox" ng-change="checkBoxChecked(options)" /><span ng-if="commandExists"><a ng-show="(options.isSelecting && options.isSelectable) || !options.isSelecting" ng-click="click()" class="pointer" style="color: {{textElement.Color == null ? \'#428bca\' : textElement.Color}};">{{textElement.Text}}</a><span ng-show="(options.isSelecting && !options.isSelectable)" style="opacity:.5;">{{textElement.Text}}</span></span><span ng-if="!commandExists"><a ng-show="options.isSelecting && options.isSelectable" ng-click="click()" class="pointer">{{textElement.Text}}</a><span ng-show="!options.isSelecting || !options.isSelectable" ng-click="click()" style="color: {{textElement.Color == null ? \'black\' : textElement.Color}};">{{textElement.Text}}</span></span></span><span ng-if="textElement.Midi"><dmusiclibrary-midi-sound midi-sound="textElement.Midi"></dmusiclibrary-midi-sound></span></span>',scope:{textElement:"=",resultIndex:"="},compile:function(d){return a.compile(d,function(a){a.options={isSelectable:!1,isSelected:!1,isSelecting:!1};var d=function(){a.options.isSelectable=c.isTextElementSelectable(a.textElement)};d(),a.commandExists=angular.isDefined(a.textElement.Command)&&null!==a.textElement.Command,a.textExists=angular.isDefined(a.textElement.Text)&&null!==a.textElement.Text;var e=function(b){a.options.isSelected!==b&&(a.options.isSelected=b,f())};a.bazzleService=c,a.isSelecting=c.selectionOptions.isSelecting,"Other"!==a.textElement.ElementType?c.registerTextElementCallback(function(){a.options.isSelecting=c.selectionOptions.isSelecting,d(),a.options.isSelecting||e(!1)}):a.commandExists&&c.registerTextElementCallback(function(){a.options.isSelecting=c.selectionOptions.isSelecting,a.options.isSelecting||e(!1)});var f=function(){a.options.isSelected?c.selectTextElement(a.textElement):c.unselectTextElement(a.textElement)};a.checkBoxChecked=function(){f()},a.click=function(){a.options.isSelecting&&a.options.isSelectable?e(!a.options.isSelected):a.commandExists&&b.goToBazzle(a.textElement.Command,null)}})}}}]).directive("dmusiclibraryTextElementHtml",["$compile",function(a){return{restrict:"E",replace:"true",transclude:!0,template:"<span></span>",scope:{htmlString:"="},link:function(b,c){var d=a("<span>"+b.htmlString+"</span>")(b);c.append(d)}}}]).directive("dmusiclibraryBazzleStaffResult",["uiService","dmusiclibraryBazzleService","dmusiclibraryNotationService",function(a,b,c){return{restrict:"E",replace:"true",transclude:!0,template:'<div class="staffContainer" style="margin: auto;"><div class="staff"></div><canvas class="staffCanvas" style="display:none;"></canvas><img class="staffImage" alt="Staff"></div>',scope:{staff:"="},link:function(a,b){var d=a.staff,e=$(b),f=e.closest(".small-panel"),g=e.find(".staff"),h=e.find(".staffCanvas"),i=e.find(".staffImage"),j=i[0],k=c.renderStaff(d.Staff,d.Report,g),l=c.getStaffWidthFromRenderer(k)+20;l>f.width()&&(l=f.width()),e.width(l),canvg(h[0],g.html());var m=h[0].toDataURL();if(j.src=m,d.Report.MeasureText.length>0){var n=d.Report.MeasureText[0];j.alt=n.Text+" Chord Notation"}g.hide()}}}]).directive("dmusiclibraryTabStaff",["uiService","dmusiclibraryInstrumentService","dmusiclibraryBazzleService",function(a,b,c){return{restrict:"E",replace:"true",transclude:!0,template:'<div class="tabStaffContainer" style="margin: auto;"><canvas class="tabStaff" style="display:none;"></canvas><img class="tabStaffImage" alt="Tab Staff"></div>',scope:{tabStaff:"="},link:function(d,e){for(var f=d.tabStaff,g=[],h=0;h<f.StringNoteNames.length;h++)g.push(f.StringNoteNames[h].Name);var i=g.length,j=[],k=!1;for(h=0;h<f.Chords.length;h++){var l=f.Chords[h],m=[];for(o=0;o<l.Notes.length;o++)p=l.Notes[o],m.push({str:i-p.StringIndex,fret:p.FretIndex});for(var n=new Vex.Flow.TabNote({positions:m,duration:1==l.Duration.Numeric?"w":2==l.Duration.Numeric?"h":"q"}),o=0;o<l.Notes.length;o++){var p=l.Notes[o];if("None"!==p.Vibrato){k=!0;var q=new Vex.Flow.Vibrato;q="Harsh"===p.Vibrato?q.setHarsh(!0).setVibratoWidth(70):q.setVibratoWidth(35),n=n.addModifier(q,o)}if("None"!==p.Bend){k=!0;var r=new Vex.Flow.Bend("Full"===p.Bend?"Full":"Half");n=n.addModifier(r,o)}}j.push(n)}var s=$(e),t=s.closest(".small-panel"),u=s.find(".tabStaff"),v=s.find(".tabStaffImage"),w=v[0],x=13,y=k?2:1,z=(g.length+y)*x,A=29*f.Chords.length,B=t.width();A>B&&(A=B),s.height(z),s.width(A);var C=new Vex.Flow.Renderer(u[0],Vex.Flow.Renderer.Backends.CANVAS),D=C.getContext();D=a.createHiDefContext(A,z,null,u[0],D,w),D.setFont("Arial",10,"").setBackgroundFillStyle("#eed");var E=new Vex.Flow.TabStave(0,0,A,{spacing_between_lines_px:13,num_lines:g.length,space_above_staff_ln:y});E.addTabGlyph(),E.setContext(D).draw(),Vex.Flow.Formatter.FormatAndDraw(D,E,j);var F=D.canvas,G=F.toDataURL();w.src=G;var H=b.getShortNameOfCurrentInstrument();c.lastCommand&&(H+=" - "+c.lastCommand),w.alt=H}}}]).directive("dmusiclibraryTextElement",["RecursionHelper","dmusiclibraryBazzleService",function(a,b){return{restrict:"E",replace:"true",template:'<span ng-show="showContents"><div ng-if="textElement && textElement.TextType === \'Div\'" ng-style="{\'padding-top\': {{textElement.PaddingTop}}, \'margin-top\': {{textElement.MarginTop}}, \'padding-bottom\': {{textElement.PaddingBottom}}};"><dmusiclibrary-text-element-text result-index="resultIndex" text-element="textElement"></dmusiclibrary-text-element-text><dmusiclibrary-text-element-content result-index="resultIndex" content="textElement.Content"></dmusiclibrary-text-element-content></div><h3 ng-if="textElement && textElement.TextType === \'H3\'" ng-style="{\'padding-top\': {{textElement.PaddingTop}}, \'margin-top\': {{textElement.MarginTop}}, \'padding-bottom\': {{textElement.PaddingBottom}}};" ><dmusiclibrary-text-element-text result-index="resultIndex" text-element="textElement"></dmusiclibrary-text-element-text><dmusiclibrary-text-element-content result-index="resultIndex" content="textElement.Content"></dmusiclibrary-text-element-content></h3><h6 ng-if="textElement && textElement.TextType === \'H6\'" ng-style="{\'padding-top\': {{textElement.PaddingTop}}, \'margin-top\': {{textElement.MarginTop}}, \'padding-bottom\': {{textElement.PaddingBottom}}};"><dmusiclibrary-text-element-text result-index="resultIndex" text-element="textElement"></dmusiclibrary-text-element-text><dmusiclibrary-text-element-content result-index="resultIndex" content="textElement.Content"></dmusiclibrary-text-element-content></h6></span>',scope:{textElement:"=",resultIndex:"="},compile:function(c){return a.compile(c,function(a){a.showContents=!0,b.subscribeAndHandleFilters(a.textElement.FilterableProperties,a.resultIndex,function(){a.showContents=!0},function(){a.showContents=!1})})}}}]).directive("dmusiclibraryBazzleFilter",["dmusiclibraryBazzleService","$rootScope",function(a){return{restrict:"E",replace:"true",transclude:!0,template:'<div>Filter By: <label>{{filter.DisplayText}}</label><select class="form-control" ng-model="filterValue" ng-options="filterValue for filterValue in filter.FilterValues" ng-change="filterValueChanged()"><option value="">No Filter</option></select></div>',scope:{filter:"=",resultIndex:"="},link:function(b){b.filterValueChanged=function(){a.applyFilter(b.filter,b.filterValue,b.resultIndex)},b.$on("filterAppliedFromPanelSettings",function(a,c){if(c.resultIndex===b.resultIndex&&c.filterName==b.filter.FilterName){var d=c.filterValue;b.filterValue=d,b.filterValueChanged()}})}}}]).directive("dmusiclibraryFiltersPanel",function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div ng-show="result && result.Filters"><accordion><accordion-group heading="Filters" is-open="true"><accordion-heading style="background-color: #e3e3e3;"><div>Filters</div></accordion-heading><div class="row"><div class="col-xs-4" ng-repeat="filter in result.Filters"><dmusiclibrary-bazzle-filter result-index="resultIndex" filter="filter"></dmusiclibrary-bazzle-filter></div></div></accordion-group></accordion></div>',scope:{result:"=",resultIndex:"="},link:function(){}}}).directive("dmusiclibraryInputAssumptionsPanel",function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div  ng-show="result && result.ElementAssumptions"><accordion><accordion-group heading="Input Assumptions" is-open="false"><accordion-heading style="background-color: #e3e3e3;"><div>Input Assumptions<div class="pull-right" ng-show="result.ElementAssumptions && result.ElementAssumptions.length > 0">{{result.ElementAssumptions.length}}</div></div></accordion-heading><div class="row"><ul style="text-align: left;"><li ng-repeat="assumption in result.ElementAssumptions" tooltip-placement="bottom">{{assumption.Text}}</li></ul></div></accordion-group></accordion></div>',scope:{result:"="},link:function(){}}}).directive("dmusiclibraryParameterAssumptionsPanel",function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div  ng-show="result"><accordion><accordion-group heading="Explanation and Assumptions" is-open="false"><accordion-heading style="background-color: #e3e3e3;"><div>Explanation and Parameter Assumptions<div class="pull-right" ng-show="result.ParameterAssumptions && result.ParameterAssumptions.length > 0">{{result.ParameterAssumptions.length}}</div></div></accordion-heading><div style="margin-left: 20px;"><div ng-if="result.ExecutionExplanation" class="row" style="margin-bottom: 10px;"><div style="text-align: left;"><span style="font-weight: bolder;">Explanation</span>: {{result.ExecutionExplanation}}</div></div><div ng-if="result.Formula" class="row" style="margin-bottom: 10px;"><div style="text-align: left;"><span style="font-weight: bolder;">Formula</span>: {{result.Formula}}</div></div><div class="row" ng-show="result.ParameterAssumptions"><ul style="text-align: left;"><li ng-repeat="assumption in result.ParameterAssumptions" tooltip="{{assumption.ToolTip}}" tooltip-placement="bottom">{{assumption.Text}}</li></ul></div></div></accordion-group></accordion></div>',scope:{result:"="},link:function(){}}}).directive("dmusiclibraryDoubtPanel",function(){return{restrict:"AE",replace:"true",transclude:!0,template:'<div  ng-show="result && result.Doubts"><accordion><accordion-group heading="Doubts" is-open="true"><accordion-heading style="background-color: #e3e3e3;"><div>Doubts<div class="pull-right error-notification" ng-show="result.Doubts && result.Doubts.length > 0" ua-toggle-class="error-notification-initial,error-notification-highlighted-initial" interval="550"  max-cycles="2">{{result.Doubts.length}}</div></div></accordion-heading><div class="row"><ul style="text-align: left;"><li ng-repeat="doubt in result.Doubts" tooltip-placement="bottom">{{doubt}}</li></ul></div></accordion-group></accordion></div>',scope:{result:"="},link:function(){}}}).directive("dmusiclibraryTool",function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div><div class="row"><div class="form-group col-sm-offset-3 col-sm-6"><div style="text-align: left;">{{explanation}}</div><textarea type="text" class="form-control" ng-model="options.input"></textarea><dmusiclibrary-edit-instrument-link></dmusiclibrary-edit-instrument-link><button type="submit" class="btn btn-primary go-button" ng-click="execute()">Go!</button><div><img ng-show="showLoading" src="images/ajax-loader.gif" alt="Please Wait..."></div></div></div><dmusiclibrary-results-panel results="results"></dmusiclibrary-results-panel></div>',scope:{options:"=",input:"=",results:"=",command:"=",execute:"=",instrument:"=",showLoading:"="},link:function(a,b,c){a.explanation=c.explanation}}}),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryChordChoicesGrid",["$timeout","dmusiclibraryChordGridService",function(a,b){var c=function(a){var c=function(a){return a.chordChoices};a.sortableOptions=b.getSortableOptions(a,c,function(){},function(){}),a.gridHelper=b.getGridHelper(a),a.$watch(function(){return a.chords},function(){a.chordChoices=angular.copy(a.chords,[])},!0)},d="<div ui-sortable='sortableOptions' class='chord-choices-grid-container chord-grid-chords' ng-model='chordChoices'><div ng-repeat = 'chord in chordChoices' dmusiclibrary-chord-grid-chord chord='chord' grid-helper='gridHelper'></div></div>";return{restrict:"AE",scope:{chords:"=",chordGridOptions:"="},link:c,template:d}}]).directive("dmusiclibraryChordGrid",["$timeout","dmusiclibraryChordGridService",function(a,b){var c=function(c,d){function e(){a(function(){c.gridHelper.computeGridVars(),c.gridHelper.setGridDivisions()},0)}var f=$(window);c.$watch(function(){return c.progression},function(){b.progression=c.progression,e()},!0),f.on("resize",e),c.sortableOptions=b.getSortableOptions(c,function(a){return a.progression},function(){},function(a,b,c){b.trigger("click",[c])}),$chordWidthTestEl=d.find(".chord-width-test-element"),c.gridHelper=b.getGridHelper(c)},d="<div ui-sortable='sortableOptions' class='chord-grid-container progression' ng-model='progression'><div ng-repeat = 'chord in progression' dmusiclibrary-chord-grid-chord chord='chord' grid-helper='gridHelper' class='prog-chord'></div></div><div class='chord-width-test-element'></div>";return{restrict:"AE",scope:{progression:"=",chordGridOptions:"="},link:c,template:d}}]).directive("dmusiclibraryChordGridChord",["dmusiclibraryChordGridService","dmusiclibraryMidiService",function(a,b){var c="<div class='chord-grid-chord' ng-context-menu=\"menuOptions\" ng-style='{ background : chord.color}'><div class='chord-name' ng-context-menu=\"menuOptions\">{{ chord.name }}</div><div dmusiclibrary-snap-to-grid config='config' ng-model='chord.units'><div class='chord-delete-button' ng-click='deleteMe()'>&times;</div><div class='chord-callback-button'>"+'<i class="fa fa-ellipsis-v black-icon-hover-grey dropdown-toggle" ng-context-menu="menuOptions"></i></div></div></div>',d=["$scope","$element","$attrs",function(a,b){function c(){b.width(a.config.formatter(a.chord.units))}var d=$(window);a.config={gridUnit:a.gridHelper.gridUnit,snapThreshold:a.gridHelper.snapThreshold,formatter:function(b){a.gridHelper.computeGridVars();var c,d;return(void 0===b||null===b)&&(b=a.chord.units=a.gridHelper.quarterNotesPerMeasure*a.gridHelper.unitsPerQuarterNote),c=b/a.gridHelper.unitsPerQuarterNote,d=c*a.gridHelper.widthPerQuarterNote},parser:function(b){a.gridHelper.computeGridVars();var c=a.gridHelper.getUnitsByWidth(b);return c}},d.on("resize",c)}],e=function(c,d){a.registerMe(d,c.chord),c.deleteMe=function(){a.deleteMe(c.chord)},c.menuOptions={onShow:function(){c.gridHelper.executeClickCallback(c.chord)},items:[]},c.menuOptions.items.push(['<li>Play <i class="fa fa-volume-up"></i></a></li> ',function(){b.playChord(c.chord)}])};return{restrict:"AE",scope:{gridHelper:"=",chord:"="},controller:d,replace:!0,link:e,template:c}}]).directive("dmusiclibrarySnapToGrid",["$rootScope",function(a){var b=$(window),c=$("html, body"),d=function(d,e,f,g){function h(b){var c,d,e,f=o();c=j(b)?b.originalEvent.changedTouches[0].clientX:b.clientX,d=c-q.offset().left,e=i(d),e>-1&&e!==f&&(k(e),a.$safeApply(function(){p.$setViewValue(e)}))}function i(a){var b=a/d.config.gridUnit,c=Math.floor(b)*d.config.gridUnit,e=Math.ceil(b)*d.config.gridUnit,f=a/c,g=a/e;return f<=1+d.config.snapThreshold?c:g>=1-d.config.snapThreshold?e:-1}function j(a){return a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]}function k(a){q.width(a)}function l(){n(),b.unbind("mousemove touchmove",h),b.unbind("mouseup touchend",l)}function m(){c.addClass("col-resize")}function n(){c.removeClass("col-resize")}function o(){return q.width()}var p=g[0],q=e.parent();p.$formatters.push(d.config.formatter),p.$parsers.push(d.config.parser),e.on("mousedown touchstart",function(a){m(),b.on("mousemove touchmove",h),b.on("mouseup touchend",l),a.stopPropagation()
}),p.$render=function(){var a=p.$viewValue;e.height(q.height()),k(a)}},e="<div class='snap-to-grid-handle' ng-transclude></div>";return{restrict:"AE",require:["ngModel"],scope:{config:"="},replace:!0,transclude:!0,link:d,template:e}}]),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryGenerateChordView",["chordService","$timeout","commService",function(a,b,c){return{restrict:"E",replace:"true",transclude:!0,template:'<div><div ng-show="stageIndex < 0"><loading></loading> Generating Chords...<div class="row" style="margin-top: 20px;"><button class="btn btn-warning" ng-click="options.cancel()">Cancel</button></div></div><div ng-if="stage && stage.name == \'Ascension\'"><dmusiclibrary-generate-chord-view-ascension options="stageOptions"></dmusiclibrary-generate-chord-view-ascension></div><div ng-if="stage && stage.name == \'MelodicInstability\'"><dmusiclibrary-generate-chord-view-melodic-instability options="stageOptions"></dmusiclibrary-generate-chord-view-melodic-instability></div><div ng-if="stage && stage.name == \'HarmonicInstability\'"><dmusiclibrary-generate-chord-view-harmonic-instability options="stageOptions"></dmusiclibrary-generate-chord-view-harmonic-instability></div><div ng-if="stage && stage.name == \'Directionality\'"><dmusiclibrary-generate-chord-view-directionality options="stageOptions"></dmusiclibrary-generate-chord-view-directionality></div><div ng-if="stage && stage.name == \'Choose\'"><dmusiclibrary-generate-chord-view-choose options="stageOptions"></dmusiclibrary-generate-chord-view-choose></div></div>',scope:{options:"="},link:function(b){b.isLoaded=!1,b.cancel=function(){b.options.cancel()};var d=function(a){return 0===a?b.destinationsInKey:b.stages[a-1].newDestinationsInKey};b.stageIndex=-1,b.setStage=function(a,c){return-1===a?void b.options.cancel():(b.stageIndex=a,b.stage=b.stages[a],c||(c=d(a)),b.stageOptions={destinationsInKey:c,previousChord:b.options.previousChord,cancel:b.cancel,previous:b.previousStage,next:b.nextStage,canGoBack:a>0},void(b.stage.modifyOptions&&b.stage.modifyOptions(c)))};var e=function(a,b,c){if(a.getCategoryFromChordCharacteristics){for(var d=a.getCategoryFromChordCharacteristics(c.Chords[0].ChordCharacteristics).ClusterIndex,e=!0,f=0;f<c.Chords.length;f++){var g=c.Chords[f].ChordCharacteristics;if(a.getCategoryFromChordCharacteristics(g).ClusterIndex!==d){e=!1;break}}return!e}return!0};b.minChordCountToSkipToFinalStage=3,b.nextStage=function(a){if(a&&(b.stages[b.stageIndex].newDestinationsInKey=a,a.Chords.length<=b.minChordCountToSkipToFinalStage))return void b.setStage(b.stages.length-1,a);var c=b.stageIndex+1;a=d(c);for(var f=c;f<b.stages.length&&(c=f,!e(b.stages[f],f,a));f++);b.setStage(c,a)},b.previousStage=function(){for(var a=null,c=b.stageIndex-1,f=c;f>=0&&(c=f,a=d(c),!a||a.Chords.length<=b.minChordCountToSkipToFinalStage||!e(b.stages[f],f,a));f--);b.setStage(c,a)},b.stages=[],b.options.previousChord&&(b.stages.push({name:"MelodicInstability",getCategoryFromChordCharacteristics:function(a){return a.MelodicInstability}}),b.stages.push({name:"HarmonicInstability",getCategoryFromChordCharacteristics:function(a){return a.HarmonicInstability},modifyOptions:function(){b.stageOptions.previousChord=null}}),b.stages.push({name:"Directionality",getCategoryFromChordCharacteristics:function(a){return a.Directionality}}),b.stages.push({name:"Ascension",getCategoryFromChordCharacteristics:function(a){return a.Ascension}})),b.stages.push({name:"Choose",modifyOptions:function(a){b.stageOptions={destinationsInKey:a,cancel:b.cancel,previous:b.previousStage,next:b.options.next,previousChord:b.options.previousChord}}}),a.generateChords(b.options.previousChord,b.options.chordToReplace,b.options.nextChord,b.options.key,b.options.useChordProgressionFormulas,function(a){var c=a.ChordDestinations.DestinationsInKeys[0];b.destinationsInKey=c,b.isLoaded=!0,b.nextStage()},function(){c.showErrorAlert("Something went wrong while generating the chords! Please let us know so that we can fix it for you. Thank you!"),b.cancel()})}}}]).directive("dmusiclibraryGenerateChordViewChoose",["dmusiclibraryChordService","$timeout","commService","dmusiclibraryVirtualCowriterService","dmusiclibraryMidiService",function(a,b,c,d,e){var f='<div ng-repeat="chord in chords"><div class="list-group"><a ng-click="chordSelected(chord)" class="list-group-item" ng-class="{\'active\': chord.selected}"><h4 class="list-group-item-heading">{{chord.Chord.TitleChordName.FullName}}</h4><p class="list-group-item-text"><div>Instability Rating: {{chord.ChordCharacteristics.MelodicInstability.Ranking}}</div><div>Dissonance Rating: {{chord.ChordCharacteristics.HarmonicInstability.Ranking}}</div><div>Strength Rating: {{chord.ChordCharacteristics.Directionality.Ranking}}</div></p></a></div></div>';return{restrict:"E",replace:"true",transclude:!0,template:'<div><div class="col-md-6"><form class="input-group" ng-submit="" style="margin-bottom: 0px;"><input type="text" class="form-control" ng-model="filterText" ng-change="filterChanged()" placeholder="Filter" id="chord_choice_filter_bar" name="search_bar" value=""><div class="input-group-btn"><button ng-click="clearFilter()" class="btn btn-warning form-control"><span class="glyphicon glyphicon-remove"></span></button></div></form><div class="panel panel-primary"><div class="panel-heading">Chord Options</div><div id="chordPanelBody" style="height: 300px; overflow: hidden; position:relative;" class="panel-body"><div ng-show="!chords || chords.length <= 0"><div>No Chords Were Found :(</div></div><div ng-show="chords">'+f+'</div></div></div></div><div class="col-md-6"><div ng-show="selectedChord" class="panel panel-success"><div class="panel-heading">Selected Chord</div><div id="chordPanelBody" class="panel-body"><div>{{selectedChord.Chord.TitleChordName.FullName}}</div><div>{{selectedChord.Chord.NoteNamesString}}</div></div></div><div><button style="margin-left: 20px;" ng-class="{\'disabled\': !selectedChord}" class="btn btn-primary pull-right" ng-click="next()">Insert Selected Chord</button><button style="margin-left: 20px;" class="btn btn-warning pull-right" ng-click="options.previous()">Go Back</button><button class="btn btn-warning pull-right" ng-click="options.cancel()">Cancel</button></div></div></div>',scope:{options:"="},link:function(a){a.selectedChord=null,a.destinationsInKey=a.options.destinationsInKey;for(var b=0;b<a.destinationsInKey.Chords.length;b++){var f=a.destinationsInKey.Chords[b];f.Chord.NoteNamesString=d.getNoteNameString(f.Chord.NoteNames)}a.originalChords=a.destinationsInKey.Chords,a.chords=angular.extend([],a.destinationsInKey.Chords),a.chordSelected=function(b){for(var c=0;c<a.chords.length;c++)a.chords[c].selected=!1;if(b.selected=!0,a.selectedChord=b,a.options.previousChord){var d=e.getMidiSoundFromChordProgression([a.options.previousChord,b.Chord],{duration:400});e.playSound(d)}else e.playChord(b.Chord)},a.chordSelected(a.chords[0]),a.next=function(){return a.selectedChord?void a.options.next(a.selectedChord.Chord):void c.showWarningAlert("Please select a chord to continue.")},a.clearFilter=function(){a.filterText="",a.filterChanged()},a.filterChanged=function(){var b=a.filterText.toUpperCase();a.chords=[];for(var c=0;c<a.originalChords.length;c++){var d=a.originalChords[c];-1!==d.Chord.TitleChordName.FullName.toUpperCase().indexOf(b)&&a.chords.push(d)}};var g=$("#chordPanelBody");g.perfectScrollbar({suppressScrollX:!0})}}}]).directive("dmusiclibraryGenerateChordViewAscension",["dmusiclibraryChordService","$timeout","commService","dmusiclibraryChordProgressionGeneratorService",function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div ng-if="isReady"><dmusiclibrary-chord-category-choice options="options"></dmusiclibrary-chord-category-choice></div>',scope:{options:"="},link:function(a){a.options.question="Based on whether the chord ascends or descends, which of the following should it sound like?",a.options.minChordProgressionLabel="Descending",a.options.maxChordProgressionLabel="Ascending",a.options.getCategoryFromChordCharacteristics=function(a){return a.Ascension},a.isReady=!0}}}]).directive("dmusiclibraryGenerateChordViewMelodicInstability",[function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div ng-if="isReady"><dmusiclibrary-chord-category-choice options="options"></dmusiclibrary-chord-category-choice></div>',scope:{options:"="},link:function(a){a.options.question="Based on whether the chord resolves or does not resolve, which of the following should it sound like?",a.options.minChordProgressionLabel="Resolved",a.options.maxChordProgressionLabel="Unresolved",a.options.getCategoryFromChordCharacteristics=function(a){return a.MelodicInstability},a.isReady=!0}}}]).directive("dmusiclibraryGenerateChordViewHarmonicInstability",[function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div ng-if="isReady"><dmusiclibrary-chord-category-choice options="options"></dmusiclibrary-chord-category-choice></div>',scope:{options:"="},link:function(a){a.options.question="Based on whether the chord is dissonant or consonant, which of the following should it sound like?",a.options.minChordProgressionLabel="Consonant",a.options.maxChordProgressionLabel="Dissonant",a.options.getCategoryFromChordCharacteristics=function(a){return a.HarmonicInstability},a.isReady=!0}}}]).directive("dmusiclibraryGenerateChordViewDirectionality",[function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div ng-if="isReady"><dmusiclibrary-chord-category-choice options="options"></dmusiclibrary-chord-category-choice></div>',scope:{options:"="},link:function(a){a.options.question="Based on whether the progression is fragile or strong, which of the following should it sound like?",a.options.minChordProgressionLabel="Fragile",a.options.maxChordProgressionLabel="Strong",a.options.getCategoryFromChordCharacteristics=function(a){return a.Directionality},a.isReady=!0}}}]).directive("dmusiclibraryChordCategoryChoice",["dmusiclibraryChordService","$timeout","commService","dmusiclibraryChordProgressionGeneratorService","dmusiclibraryMidiService",function(a,b,c,d,e){return{restrict:"E",replace:"true",transclude:!0,template:'<div ng-if="allQa"><button ng-if="options.canGoBack" class="btn btn-warning" ng-click="previous()">Go Back</button><button ng-if="!options.canGoBack" class="btn btn-warning" ng-click="cancel()">Cancel</button><div question-answer-wizard all-qa="allQa" post-question-html="postQuestionHtml" q-index="qIndex" show-buttons="false" speed="300"></div></div>',scope:{options:"="},link:function(a){for(var c=null,f=null,g=0,h=0,i=0;i<a.options.destinationsInKey.Chords.length;i++){var j=a.options.destinationsInKey.Chords[i],k=a.options.getCategoryFromChordCharacteristics(j.ChordCharacteristics);(null===c||k.Ranking<g)&&(c=j,g=k.Ranking),(null===f||k.Ranking>h)&&(f=j,h=k.Ranking)}var l=function(b){return d.filterByChordCharacteristicCategoryValue(a.options.destinationsInKey,a.options.getCategoryFromChordCharacteristics,b)},m=750,n=a.options.previousChord?e.getMidiSoundFromChordProgression([a.options.previousChord,c.Chord],{duration:m}):c.Chord.ChordSound,o=a.options.previousChord?e.getMidiSoundFromChordProgression([a.options.previousChord,f.Chord],{duration:m}):f.Chord.ChordSound;m=n.Chords[0].LongestDuration,a.options.previousChord&&(m*=2),a.playOptions={isPlaying:!1};var p={getMinMidiSound:function(){return n},getMaxMidiSound:function(){return o},question:a.options.question,answers:["First Progression","Second Progression","Either"],selected:null,callback:function(b){a.next(0===b?l(0):1===b?l(1):a.options.destinationsInKey)},onPresented:function(){var c=function(a){var b=m+1e3,c=$("#"+a);c.find("i").effect("highlight",{},b),c.find(".chord-category-label").effect("highlight",{},b)};b(function(){a.aborted||(e.playSound(n,a.playOptions,function(){a.aborted||b(function(){a.aborted||(e.playSound(o,a.playOptions,function(){}),c("maxMidiPlayerContainer"))},a.options.previousChord?500:0)}),c("minMidiPlayerContainer"))},0)}};a.postQuestionHtml='<div><div id="minMidiPlayerContainer" class="col-md-offset-3 col-md-3"><midi-sound-black-icon get-midi-sound="currentQ.getMinMidiSound"></midi-sound-black-icon><span class="chord-category-label">'+a.options.minChordProgressionLabel+'</span></div><div id="maxMidiPlayerContainer" class="col-md-3 col-md-offset-3">   <midi-sound-black-icon get-midi-sound="currentQ.getMaxMidiSound"></midi-sound-black-icon><span class="chord-category-label">'+a.options.maxChordProgressionLabel+"</span></div></div>",a.allQa=[p],a.qIndex=0,a.abort=function(){a.playOptions.isPlaying=!1,a.aborted=!0},a.next=function(b){a.options.next(b)},a.previous=function(){a.abort=!0,a.options.previous()},a.cancel=function(){a.abort=!0,a.options.cancel()}}}}]).directive("dmusiclibraryChooseChordVoicingView",["$timeout","dmusiclibraryChordService","dmusiclibraryVirtualCowriterService",function(a,b,c){var d='<div ng-repeat="voicing in voicings"><div class="list-group"><a ng-click="voicingSelected(voicing)" class="list-group-item" ng-class="{\'active\': voicing.selected}"><h4 class="list-group-item-heading">{{voicing.NoteNamesString}}</h4><p class="list-group-item-text">{{voicing.TitleChordName.FullName}}</p></a></div></div>';return{restrict:"E",replace:"true",transclude:!0,template:'<div><div class="col-md-6"><div ng-show="!voicings"><loading></loading> Generating Voicings...</div><div><div ng-show="voicings" class="panel panel-primary"><div class="panel-heading">{{options.chord.TitleChordName.FullName}} Voicing Options</div><div id="voicingPanelBody" style="height: 300px; overflow: hidden; position:relative;" class="panel-body">'+d+'</div></div></div></div><div class="col-md-6"><div ng-show="selectedVoicing" class="panel panel-success"><div class="panel-heading">Selected Voicing</div><div id="chordPanelBody" class="panel-body"><div>{{selectedVoicing.NoteNamesString}}</div></div></div><div><button style="margin-left: 20px;" ng-class="{\'disabled\': !selectedVoicing}" class="btn btn-primary pull-right" ng-click="next()">Next</button><button class="btn btn-warning pull-right" ng-click="cancel()">Cancel</button></div></div></div>',scope:{options:"="},link:function(d){d.selectedVoicing=null,d.voicingSelected=function(a){for(var b=0;b<d.voicings.length;b++)d.voicings[b].selected=!1;a.selected=!0,d.selectedVoicing=a},d.next=function(){d.options.next(d.selectedVoicing)},d.cancel=function(){d.options.cancel()},d.$watch(function(){return d.voicings},function(){});var e=$("#voicingPanelBody");e.perfectScrollbar({suppressScrollX:!0}),b.getVoicings(d.options.chord,{},function(b){d.voicings=b.Voicings;for(var f=0;f<d.voicings.length;f++){var g=d.voicings[f];g.NoteNamesString=c.getNoteNameString(g.NoteNames)}d.voicingSelected(d.voicings[0]),a(function(){e.perfectScrollbar("update")},0)},function(){})}}}]),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryEditInstrumentDropdown",["dmusiclibraryInstrumentService","$rootScope","commService",function(a,b,c){return{restrict:"E",replace:"true",transclude:!0,template:'<div><div class="col-md-10" style="margin-left: 0px; padding-left: 0px;"><select class="form-control" ng-model="basicGuitar" ng-options="basicGuitar.BasicName for basicGuitar in basicGuitars" ng-change="instrumentChanged()"><option value="">{{originallySelectedInstrument.Name}}</option></select></div><div class="col-md-2" style="margin-right: 0px; margin-left: 0px; padding-right: 0px; padding-left: 0px;"><div class="input-group-btn"><button ng-click="editInstrument()" tooltip="Customize Your Instrument" tooltip-placement="bottom" type="submit" class="btn form-control" ng-class="{\'btn-primary\' : blueButton}" style="border-radius: 4px;"><span class="glyphicon glyphicon-pencil"></span></button></div></div></div>',scope:{blueButton:"="},link:function(d){d.editInstrument=function(){a.goToEditInstrument()};var e="editInstrumentLink"+d.$id,f=function(){d.originallySelectedInstrument=a.instrument,d.basicGuitar=null,d.basicGuitars=a.basicGuitars,b.$on("instrumentChanged",function(a,b){if(b.sender!==e)for(var c=0;c<d.basicGuitars.length;c++)if(b.instrument.Name===d.basicGuitars[c].Name){d.basicGuitar=d.basicGuitars[c];break}})};a.initialized?f():b.$on("instrumentServiceInitialized",function(){f()}),d.instrumentChanged=function(){d.basicGuitar?a.setInstrument(d.basicGuitar,e):a.setInstrument(d.originallySelectedInstrument,e),c.showSuccessAlert("Your instrument has been changed to "+a.getNameOfCurrentInstrument()+".")}}}}]).directive("dmusiclibraryGuitarString",function(){return{restrict:"E",replace:"true",transclude:!0,template:'<div class="row guitar-string-well" style="margin-top: 5px;"><div style="float: left">{{guitarString.stringNumber}}</div><div class="col-sm-3">Start Fret: <select ng-change="onGuitarStartingFretChanged(guitarString)" class="form-control" required ng-model="guitarString.startingFret" ng-options="fretOption for fretOption in fretOptions"></select></div><div class="col-sm-3">End Fret: <select ng-change="onGuitarEndingFretChanged(guitarString)" class="form-control" required ng-model="guitarString.endingFret" ng-options="fretOption for fretOption in fretOptions"></select></div><div class="col-sm-2">Note: <select ng-change="onGuitarTuningChanged(guitarString)" class="form-control" required ng-model="guitarString.noteName" ng-options="noteOption for noteOption in noteOptions"></select></div><div class="col-sm-2">Octave: <select ng-change="onGuitarTuningChanged(guitarString)" class="form-control" required ng-model="guitarString.octave" ng-options="octaveOption for octaveOption in octaveOptions"></select></div><div class="col-sm-1"><a ng-click="onRemoveString(guitarString)">Remove String<span class="glyphicon glyphicon-remove"></span></a></div></div>',scope:{guitarString:"=",noteOptions:"=",octaveOptions:"=",fretOptions:"=",onRemoveString:"=",onGuitarTuningChanged:"=",onGuitarStartingFretChanged:"=",onGuitarEndingFretChanged:"="},link:function(){}}}).directive("dmusiclibraryInstrumentFretboard",["dmusiclibraryFretboardJsService","navigationService","$timeout","dmusiclibraryInstrumentService",function(a,b,c,d){return{restrict:"E",replace:"true",transclude:!0,template:'<div class="instrument-fretboard-container"><a id="fretboard"></a><div ng-if="fretboardConfig" class="instrument-fretboard" fretboard fretboard-config="fretboardConfig"></div><div ng-if="clearFretsButton" class="clearfix"><button class="btn-warning unclick-btn pull-left" ng-click = "unclick()">Clear Frets</button></div></div>',scope:{options:"=",clearFretsButton:"="},link:function(e,f){e.fretboardConfig=null,e.initializeFretboard=function(){a.getDefaultFretboardConfig(e.isChordMode).then(function(a){e.fretboardConfig=angular.extend(a,e.options.fretboardConfig),e.options.fretboardConfig&&angular.isDefined(e.options.fretboardConfig.numFrets)||(e.fretboardConfig.numFrets=d.getMaxFret())})},c(function(){e.initializeFretboard()}),e.getTabString=function(){return a.getTabStringFromFretboard(e.isChordMode,e.fretboardConfig)},e.unclick=function(){e.fretboardConfig.clickedNotes=[]},e.$on("instrumentChanged",function(){c(function(){a.getTuning().then(function(a){e.fretboardConfig&&(e.fretboardConfig.numFrets=d.getMaxFret(),e.fretboardConfig.guitarStringNotes=angular.copy(a))})},0)}),e.$on("setFretboardNotes",function(c,d){e.fretboardConfig.clickedNotes=[];var g=0;if(d.tabChord?(a.addChordToFretboard(e.fretboardConfig,d.tabChord),d.tabChord.FretsPerString.forEach(function(a){null!==a&&a>g&&(g=a)})):d.scaleChartResult&&(a.addScaleToFretboard(e.fretboardConfig,d.scaleChartResult),d.scaleChartResult.TabScale.Notes.forEach(function(a){null!==a.FretIndex&&a.FretIndex>g&&(g=a.FretIndex)})),d.scrollToFirstNote){var h=e.fretboardConfig.fretboardOrigin[1],i=e.fretboardConfig.fretWidth,j=f,k=j.find(".instrument-fretboard"),l=k.width();g+=3;var m=g*i-l+h;0>=m&&(m=0),k[0].scrollLeft=m}d.scrollToFretboard&&b.scrollToHash("fretboard")})}}}]),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryMidiSound",["dmusiclibraryMidiService",function(a){return{restrict:"E",replace:"true",transclude:!0,template:'<span><img ng-src="{{form.icon}}" ng-if="midiSound" style="height: 16px;" ng-click="playSound(midiSound)" alt="Play"></span>',scope:{midiSound:"="},controller:["$scope",function(a){a.form={icon:"/sites/musiclibrary/images/midi/play.png"}}],link:function(b){b.playSound=function(c){b.form.icon="/sites/musiclibrary/images/midi/pause.png",a.playSound(c,{},function(){b.form.icon="/sites/musiclibrary/images/midi/play.png"})}}}}]).directive("dmusiclibraryMidiSoundBlackIcon",["dmusiclibraryMidiService",function(a){return{restrict:"E",replace:"true",transclude:!0,template:'<div><div ng-show="!playOptions.playing"><i class="fa fa-play-circle fa-4x black-icon-hover-grey" ng-click="play()"></i></div><div ng-show="playOptions.playing"><i class="fa fa-stop fa-4x black-icon-hover-grey" ng-click="stop()"></i></div></div>',scope:{getMidiSound:"="},link:function(b){b.playOptions={playing:!1},b.play=function(){b.playOptions.playing=!0,a.playSound(b.getMidiSound(),b.playOptions,function(){b.playOptions.playing=!1})},b.stop=function(){b.playOptions.playing=!1,a.stop()}}}}]),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryQuestionAnswerWizard",["$rootScope","$compile",function(a,b){var c=function(c,d){function e(){return!c.allQa||!c.allQa.length||!angular.isNumber(c.qIndex)||c.qIndex<0||c.qIndex>c.allQa.length-1?(console.log("qIndex was not valid: "+c.qIndex),!1):!0}function f(){q=!0,m(),a.$safeApply(function(){c.animating=!1})}function g(){c.animating=!0,t.css("width",s.width())}function h(){var a=p.width(),b=r.position().left,c=b+parseInt(s.css("margin-left"));return{winWidth:a,allQaContainerLeft:b,$questionContainer:s,$questionAnimatedContainer:t,questionAnimatedContainerWidth:t.width(),finalAnimatedLeftVal:c}}function i(){return d.find(".post-question-container")}function j(){return d.find(".question-animated-container")}function k(){return d.find(".question-container")}function l(){return d.find(".all-qa-container")}function m(){var a=k(),b=a.children(),d=0;b.each(function(){var a=$(this);d+=a.outerHeight()}),a.animate({height:d},c.speed/1.5)}function n(){g();var a=h();a.$questionAnimatedContainer.animate({left:a.finalAnimatedLeftVal},c.speed/1.5,function(){f()})}var o,p=$(window),q=!1,r=l(),s=k(),t=j(),u=i();if(c.speed=angular.isNumber(c.speed)?c.speed:300,c.currentQ=null,c.animating=!1,c.show=!0,c.postQuestionHtml){var v=b(c.postQuestionHtml),w=v(c);u.html(""),u.append(w)}$("body").addClass("has-question-answer-wizard"),c.$watch(function(){return c.qIndex},function(a,b){e()&&(a>=b?c.next():b>a&&c.previous())}),c.executeCallback=function(a){return c.currentQ.selected=a,c.currentQ.callback&&!angular.isFunction(c.currentQ.callback)?(console.log("The callback for the current question is not a function: "),void console.log(c.currentQ)):void c.currentQ.callback(a)};var x=function(){c.currentQ.onPresented&&c.currentQ.onPresented(c.currentQ)};c.next=function(){var b=h();g(),q?b.$questionAnimatedContainer.css("position","absolute").animate({left:"-"+b.questionAnimatedContainerWidth+"px"},c.speed,function(){a.$safeApply(function(){c.currentQ=c.allQa[c.qIndex],b.$questionAnimatedContainer.css({position:"absolute",left:b.winWidth}).animate({left:b.finalAnimatedLeftVal},c.speed,f),x()})}):(c.currentQ=c.allQa[c.qIndex],b.$questionAnimatedContainer.css({position:"absolute",left:b.winWidth}).animate({left:b.finalAnimatedLeftVal},c.speed,f),x())},c.previous=function(){var b=h();g(),b.$questionAnimatedContainer.css("position","absolute").animate({left:b.winWidth},c.speed,function(){a.$safeApply(function(){c.currentQ=c.allQa[c.qIndex],b.$questionAnimatedContainer.css({position:"absolute",left:"-"+b.questionAnimatedContainerWidth+"px"}).animate({left:b.finalAnimatedLeftVal},c.speed,f),x()})})},c.incrementQIndex=function(){++c.qIndex},c.decrementQIndex=function(){--c.qIndex},p.on("resize",function(){clearTimeout(o),o=setTimeout(n,100)})},d="<div ng-show='show' class='all-qa-container'><div class='question-container'><div class='question-animated-container answers num-{{currentQ.answers.length}}'><h3 class='question-text '>{{currentQ.question}}</h3><div class=\"post-question-container\"></div><div ng-class='{ selected: currentQ.selected === {{$index}} }' class='answer-text num-{{$index+1}}' ng-click='executeCallback($index)' ng-repeat='a in currentQ.answers'>{{a}}</div></div></div></div><div class='button-container' ng-show='showButtons'><button ng-disabled='!qIndex || animating' ng-show='show' class='btn btn-success prev-button' ng-click='decrementQIndex()'>Previous</button><button ng-disabled='qIndex===allQa.length-1 || animating' ng-show='show' class='btn btn-success next-button' ng-click='incrementQIndex()'>Next</button></div>";return{restrict:"AE",scope:{allQa:"=allQa",qIndex:"=qIndex",showButtons:"=showButtons",speed:"=speed",postQuestionHtml:"="},link:c,template:d}}]),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryStaff",["uiService","dmusiclibraryInstrumentService","dmusiclibraryNotationService",function(a,b,c){return{restrict:"E",replace:"true",transclude:!0,template:'<div class="staffContainer" style="margin: auto;"><div class="staff" style="width: 100%; height: 200px;"></div><canvas class="staffCanvas" style="display:none;"></canvas><img class="staffImage" alt="Staff"></div>',scope:{staff:"=",report:"=",onImageRendered:"=",containerParentClass:"="},link:function(a,b){var d=a.staff,e=a.report,f=$(b),g=f.find(".staff"),h=f.find(".staffCanvas"),i=f.find(".staffImage"),j=i[0],k=c.renderStaff(d,e,g),l=a.containerParentClass?f.closest("."+a.containerParentClass):null;if(null!==l){var m=c.getStaffWidthFromRenderer(k)+20;m>l.width()&&(m=l.width()),f.width(m)}canvg(h[0],g.html());var n=h[0].toDataURL();if(j.src=n,a.onImageRendered&&a.onImageRendered(n),g.hide(),a.report.MeasureText.length>0){var o=a.report.MeasureText[0];j.alt=o.Text+" "+a.report.ReportName+" Notation"}}}}]),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryToolRouter",["$routeParams",function(a){return{replace:!0,restrict:"E",template:'<div><div ng-if="route===\'bazzle\'"><dmusiclibrary-bazzle></dmusiclibrary-bazzle></div><div ng-if="route===\'vc\'"><dmusiclibrary-virtual-cowriter></dmusiclibrary-virtual-cowriter></div><div ng-if="!route"><dmusiclibrary-browse-tools></dmusiclibrary-browse-tools></div></div>',scope:{},link:function(b){b.routeParams=a,b.$watch("routeParams.toolRoute",function(a){b.route=a,b.route&&(b.route=b.route.toLowerCase())})}}}]).directive("dmusiclibraryBrowseTools",["$routeParams",function(){return{replace:!0,restrict:"E",template:"<div>Tools!</div>",scope:{},link:function(){}}}]),angular.module("dmusiclibrary.Directives").directive("dmusiclibraryVirtualCowriter",[function(){return{restrict:"E",replace:!0,templateUrl:"/sites/musiclibrary/app-templates/virtual-cowriter.html",controller:["$scope","$routeParams","commService","navigationService","dmusiclibraryVirtualCowriterService","dmusiclibraryInstrumentService","metaService","dmusiclibraryChordService","dmusiclibraryScaleService","dmusiclibraryNavigationService",function(a,b,c,d,e,f,g,h,i,j){a.search=function(){a.categories=null,a.chordProgression=null,a.chord=null,a.scale=null,a.commandElement=null,a.processing=!0,e.commandElements=null,e.musicElements=null,a.unknownElements=[],a.noResults=!1,a.originalCommand=null,a.error=null,e.parse(a.command,function(b){e.commandElements=b.ParsedCommand.CommandElements,a.chord=null,a.scale=null,a.commandElement=null,a.noResults=b.ParsedCommand.AlmostKnownCommandElements.length<=0&&b.ParsedCommand.CommandElements.length<=0,a.originalCommand=b.ParsedCommand.OriginalCommand,a.unknownElements=[];for(var c=0;c<b.ParsedCommand.AlmostKnownCommandElements.length;c++){var d=b.ParsedCommand.AlmostKnownCommandElements[c],g="We couldn't quite understand \""+d.Text+'".';g+=d.IsTab?" Is this possibly a chord for a different instrument than "+f.getShortNameOfCurrentInstrument()+"?":" Please consider revising.",a.unknownElements.push({error:g,element:d})}for(var k=function(b){a.command=m.Text+" "+n[b].text,j.goToVirtualCowriter(a.command)},l=0;l<b.ParsedCommand.CommandElements.length;l++){var m=b.ParsedCommand.CommandElements[l];a.commandElement=m;var n=[],o=m.IsAnyChord,p=m.IsAnyScale,q=m.IsTab,r=m.IsChordProgression;if(o&&n.push({answer:"A Chord",text:"Chord"}),p&&n.push({answer:"A Scale",text:"Scale"}),q&&n.push({answer:"Tab",text:"Tab"}),r&&n.push({answer:"A Chord Progression",text:"Chord Progression"}),n.length>1){a.categories=n;for(var s=[],t=0;t<n.length;t++)s.push(n[t].answer);a.allQa=[{question:'What is "'+m.Text+'"?',answers:s,selected:null,callback:k}],a.qIndex=0}else{if(o){var u=m.Chords[0];a.commandElement.musicElement=u,a.chord=u,h.fillChordData(u)}if(p){var v=m.Scales[0];a.scale=v,a.commandElement.musicElement=v,i.fillScaleData(v)}if(q){var w=m.Tab[0];a.tab=w,a.commandElement.musicElement=w,h.fillChordData(w.Chord)}if(r){var x=m.ChordProgression;a.chordProgression=x,a.commandElement.musicElement=x;for(var y=x.Chords,z=0;z<y.length;z++)h.fillChordData(y[z].IsTabChord?y[z].Chord:y[z],{RemoveSimilarCharts:!0,ExcludedDifficulties:["Impossible"]});i.fillChordProgressionData(x)}}}e.musicElements=[],a.chords&&(e.musicElements=e.musicElements.concat(a.chords)),a.scale&&e.musicElements.push(a.scale),a.processing=!1},function(b){a.error=b.ErrorReason,a.processing=!1})},window.prerenderReady=!1,a.initialized=function(){};var k=function(){a.processing=!1;var b=j.getCommandFromRoute(),d=j.getInstrumentFromRoute();if(b||(b=e.lastCommand?e.lastCommand:"Am7"),b&&(b=b.replace(new RegExp("-","g")," ")),a.command=b,b){window.prerenderReady=!1;var h=b.split(" "),i=d;i||(i=f.getShortNameOfCurrentInstrument()),h.length>0&&"TAB"===h[h.length-1].toUpperCase()&&(h[h.length-1]="Chord",h.push("Chart")),h.push("-"),h.push(i);for(var k=0;k<h.length;k++){var l=h[k];l.length>0&&(h[k]=l.charAt(0).toUpperCase()+l.slice(1))}var m=h.join(" ");g.setTitle(m+" | Virtual Co-writer"),g.setDescription("Virtual Co-writer results for: '"+m+"'")}else window.prerenderReady=!0;d?(c.showWarningAlert("Your instrument is being changed to "+d+".",{onlyIfUnique:!0}),f.setInstrumentFromName(d,function(){a.search()},function(){a.search()})):a.search()};f.initialized?k():a.$on("instrumentServiceInitialized",function(){k()}),a.$on("$routeChangeSuccess",function(){k()})}],link:function(){}}}]).directive("dmusiclibraryChordOrTabChordPanel",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div><div ng-if="chordOrTabChord.IsTabChord"><dmusiclibrary-tab-chord-panel tab-chord="chordOrTabChord"></dmusiclibrary-tab-chord-panel></div><div ng-if="!chordOrTabChord.IsTabChord"><dmusiclibrary-chord-panel chord="chordOrTabChord"></dmusiclibrary-chord-panel></div></div>',scope:{chordOrTabChord:"="},link:function(){}}}]).directive("dmusiclibraryTabChordPanel",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><dmusiclibrary-tab-basic-info tab-chord="tabChord"></dmusiclibrary-tab-basic-info><dmusiclibrary-chord-staff-area chord="tabChord.Chord"></dmusiclibrary-chord-staff-area><dmusiclibrary-chord-inversions-area chord="tabChord.Chord"></dmusiclibrary-chord-inversions-area><div style="margin-top: 20px;"><h3>Chord Charts</h3><dmusiclibrary-chord-charts ng-if="tabChord.Chord.ChordCharts" row-size="1" suppress-panels="true" chord="tabChord.Chord" chord-charts="tabChord.Chord.ChordCharts"></dmusiclibrary-chord-charts></div></div>',scope:{tabChord:"="},link:function(){}}}]).directive("dmusiclibraryChordPanel",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><dmusiclibrary-chord-basic-info chord="chord"></dmusiclibrary-chord-basic-info><dmusiclibrary-chord-staff-area chord="chord"></dmusiclibrary-chord-staff-area><dmusiclibrary-chord-inversions-area chord="chord"></dmusiclibrary-chord-inversions-area><div style="margin-top: 20px;"><h3>Chord Charts</h3><dmusiclibrary-chord-charts ng-if="chord.ChordCharts" row-size="1" suppress-panels="true" chord="chord" chord-charts="chord.ChordCharts"></dmusiclibrary-chord-charts></div></div>',scope:{chord:"="},link:function(){}}
}]).directive("dmusiclibraryChordProgressionScalesOfBestFit",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><h3>Scales of Best Fit</h3><div ng-repeat="scale in scalesOfBestFit"><dmusiclibrary-scale-line scale="scale"></dmusiclibrary-scale-line></div></div>',scope:{chordProgression:"=",scalesOfBestFit:"="},link:function(){}}}]).directive("dmusiclibraryChordProgressionBasicInfo",["dmusiclibraryNavigationService",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><h4 style="margin-top: 0px; font-weight: bolder;" ><span class="has-context-menu" ng-context-menu="menuOptions">{{chordProgression.Title}}</span> <dmusiclibrary-midi-sound midi-sound="chordProgression.MidiSound"></dmusiclibrary-midi-sound></h4><div style="margin-top: 20px;"><div ng-repeat="chord in chordProgression.Chords"><div ng-if="chord.IsTabChord"><dmusiclibrary-chord-line chord="chord.Chord"></dmusiclibrary-chord-line></div><div ng-if="!chord.IsTabChord"><dmusiclibrary-chord-line chord="chord"></dmusiclibrary-chord-line></div></div></div></div>',scope:{chordProgression:"="},link:function(b){b.menuOptions={onShow:null,items:[]},b.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+b.chordProgression.Title,function(){a.goToVirtualCowriter(b.chordProgression.Title)}])}}}]).directive("dmusiclibraryTabChordName",["navigationService","dmusiclibraryVirtualCowriterService","dmusiclibraryNavigationService",function(a,b,c){return{restrict:"E",replace:!0,transclude:!0,template:'<span ng-click="tabChordNameClicked()" class="has-context-menu" ng-context-menu="menuOptions">{{tabChord.Title}}</span>',scope:{tabChord:"="},link:function(a){a.tabChordNameClicked=function(){b.showChordOnFretboard(a.tabChord,!1)},a.menuOptions={onShow:null,items:[]},a.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+a.tabChord.Title,function(){c.goToVirtualCowriter(a.tabChord.Title)}]),a.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> as Scale",function(){c.goToVirtualCowriter(a.tabChord.Title+" Scale")}]),a.menuOptions.items.push(["View on Fretboard",function(){b.showChordOnFretboard(a.tabChord,!0)}])}}}]).directive("dmusiclibraryTabBasicInfo",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><h3 style="margin-top: 0px; font-weight: bolder;"><dmusiclibrary-tab-chord-name tab-chord="tabChord"></dmusiclibrary-tab-chord-name> <dmusiclibrary-midi-sound midi-sound="tabChord.Chord.ChordSound"></dmusiclibrary-midi-sound></h3><dmusiclibrary-chord-basic-info chord="tabChord.Chord"></dmusiclibrary-chord-basic-info></div>',scope:{tabChord:"="},link:function(){}}}]).directive("dmusiclibraryScaleBasicInfo",["navigationService","dmusiclibraryVirtualCowriterService","dmusiclibraryNavigationService",function(a,b,c){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><h3 style="margin-top: 0px; font-weight: bolder;"><span class="has-context-menu" ng-context-menu="menuOptions">{{scaleName}}</span></h3><h5 style="font-weight: bolder;"><dmusiclibrary-note-name-list note-names="scale.NoteNamesWithinOctave"></dmusiclibrary-note-name-list> <dmusiclibrary-midi-sound midi-sound="scale.MidiSound"></dmusiclibrary-midi-sound></h5><h5 style="font-weight: bolder;"><dmusiclibrary-note-number-name-list note-number-names="scale.ScaleFormula.NoteNumberNames"></dmusiclibrary-note-number-name-list></h5></div>',scope:{scale:"=",commandElement:"="},link:function(a){a.scaleName=b.getScaleName(a.scale),a.noteNameString=b.getNoteNameString(a.scale.NoteNamesWithinOctave),a.menuOptions={onShow:null,items:[]},a.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+(a.scale.IsNameUnknown?a.noteNameString:a.scaleName),function(){c.goToVirtualCowriter(a.noteNameString+" Scale")}]),a.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> as Chord",function(){c.goToVirtualCowriter(a.noteNameString+" as Chord")}])}}}]).directive("dmusiclibraryScaleTabStaff",["$timeout","navigationService","dmusiclibraryVirtualCowriterService","dmusiclibraryNavigationService",function(a,b,c,d){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="scale-tab-staff-container text-center"><div ng-if="ready"><div ng-if="scale.ScaleChartResult.CouldNotFit"><p style="color: red;">Sadly we had some difficulty fitting this scale onto the current instrument :(. Please consider modifying either the scale or the instrument.</p></div><div ng-if="!scale.ScaleChartResult.CouldNotFit"><dmusiclibrary-tab-staff class="has-context-menu" ng-context-menu="menuOptions" tab-staff="scale.ScaleChartResult.TabStaff"></dmusiclibrary-tab-staff>{{scale.ScaleChartResult.ScaleChart.GuitarType}} <dmusiclibrary-midi-sound midi-sound="scale.ScaleChartResult.TabScale.MidiSound"></dmusiclibrary-midi-sound></div></div></div>',scope:{scale:"="},link:function(b){b.scaleName=c.getScaleName(b.scale,!0),b.noteNameString=c.getNoteNameString(b.scale.NoteNamesWithinOctave),b.searchText=c.getNoteNameString(b.scale.NoteNamesWithinOctave,!0),b.menuOptions={onShow:null,items:[]},b.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+b.scaleName,function(){d.goToVirtualCowriter(b.searchText)}]),b.$watch("scale.ScaleChartResult",function(c){c&&(b.ready=!1,a(function(){b.ready=!0},0))})}}}]).directive("dmusiclibraryScaleStaff",["navigationService","dmusiclibraryVirtualCowriterService","dmusiclibraryNavigationService",function(a,b,c){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="scale-staff-container row" style="width: 100%;"><dmusiclibrary-staff class="has-context-menu" ng-context-menu="menuOptions" staff="staff.Staff" report="staff.Report" container-parent-class="\'scale-staff-container\'"></dmusiclibrary-staff><dmusiclibrary-midi-sound midi-sound="scale.MidiSound"></dmusiclibrary-midi-sound></div>',scope:{scale:"=",staff:"="},link:function(a){a.scaleName=b.getScaleName(a.scale,!0),a.noteNameString=b.getNoteNameString(a.scale.NoteNamesWithinOctave),a.searchText=b.getNoteNameString(a.scale.NoteNamesWithinOctave,!0),a.menuOptions={onShow:null,items:[]},a.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+a.scaleName,function(){c.goToVirtualCowriter(a.searchText)}])}}}]).directive("dmusiclibraryScaleLine",["dmusiclibraryNavigationService","dmusiclibraryVirtualCowriterService",function(a,b){return{restrict:"E",replace:!0,transclude:!0,template:'<div><span ng-show="!showDetails"><span class="has-context-menu" ng-context-menu="menuOptions">{{scaleName}} </span> <dmusiclibrary-midi-sound midi-sound="scale.MidiSound"></dmusiclibrary-midi-sound></span><div class="darker-well" ng-if="showDetails"><span class="glyphicon glyphicon-remove remove-icon" ng-click="removeClicked()"></span><dmusiclibrary-scale-basic-info scale="scale"></dmusiclibrary-scale-basic-info></div></div>',scope:{scale:"="},link:function(c){c.showDetails=!1,c.removeClicked=function(){c.showDetails=!1},c.$watch("scale",function(d){d&&(c.scaleName=b.getScaleName(c.scale,!0),c.noteNameString=b.getNoteNameString(c.scale.NoteNamesWithinOctave),c.searchText=b.getNoteNameString(c.scale.NoteNamesWithinOctave,!0),c.menuOptions={onShow:null,items:[]},c.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+c.scaleName,function(){a.goToVirtualCowriter(c.searchText+" Scale")}]),c.menuOptions.items.push(["Details",function(){c.showDetails=!0}]))})}}}]).directive("dmusiclibraryScaleModes",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><div ng-repeat="mode in modes"><dmusiclibrary-scale-line scale="mode"></dmusiclibrary-scale-line></div></div>',scope:{scale:"=",modes:"="},link:function(){}}}]).directive("dmusiclibraryHarmonizedChords",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><h5 style="font-weight: bolder;">{{harmonizedChords.Title}}</h5><div ng-if="chords"><div ng-repeat="chord in chords"><dmusiclibrary-chord-line chord="chord" prefer-chord-symbol="true"></dmusiclibrary-chord-line></div></div></div>',scope:{scale:"=",harmonizedChords:"="},link:function(a){a.chords=[],a.harmonizedChords.Chords.forEach(function(b){b.length>0&&a.chords.push(b[0])})}}}]).directive("dmusiclibraryVcScaleChart",["$rootScope","dmusiclibraryNavigationService","dmusiclibraryVirtualCowriterService","dmusiclibraryScaleService",function(a,b,c,d){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center" ng-click="scaleChartClicked()" ><dmusiclibrary-chord-chart ng-if="ready" class="has-context-menu" ng-context-menu="menuOptions" chord-chart="scaleChartResult.ScaleChart"></dmusiclibrary-chord-chart><div>{{scaleChartResult.ScaleChart.GuitarType}} <dmusiclibrary-midi-sound midi-sound="scaleChartResult.TabScale.MidiSound"></dmusiclibrary-midi-sound></div></div>',scope:{scale:"=",scaleChartResult:"="},link:function(e){e.scaleName=c.getScaleName(e.scale),e.noteNameString=c.getNoteNameString(e.scale.NoteNamesWithinOctave),e.menuOptions={onShow:null,items:[]},e.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+e.noteNameString,function(){b.goToVirtualCowriter(e.noteNameString)}]),e.menuOptions.items.push(["View on Fretboard",function(){f(!0)}]);var f=function(b){var c={scaleChartResult:e.scaleChartResult,scrollToFirstNote:!0,scrollToFretboard:b};a.$broadcast("setFretboardNotes",c),a.$emit("setFretboardNotes",c)};e.scaleChartClicked=function(){f(!1)},e.renderChart=function(){e.scaleChartResult.ScaleChart.Title=e.scaleName,e.ready=!0,f()},e.renderChart(),e.$on("instrumentChanged",function(){e.ready=!1,d.setScaleChartFromService(e.scale,{PreferredMaxFretsPerString:null},function(){e.scaleChartResult=e.scale.ScaleChartResult,e.renderChart()},function(){e.renderChart()})})}}}]).directive("dmusiclibraryChordInversionsArea",[function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div><div ng-show="!chord.inversions"><loading></loading> Loading {{chord.TitleChordName.FullName}} Inversions...</div><dmusiclibrary-chord-inversions ng-if="chord.inversions" chord="chord" inversions="chord.inversions"></dmusiclibrary-chord-inversions></div>',scope:{chord:"="},link:function(){}}}]).directive("dmusiclibraryChordStaffArea",[function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div><div ng-show="!chord.Staff"><loading></loading> Loading {{chord.TitleChordName.FullName}} Notation...</div><dmusiclibrary-chord-staff ng-if="chord.Staff" chord="chord" staff="chord.Staff"></dmusiclibrary-chord-staff></div>',scope:{chord:"="},link:function(){}}}]).directive("dmusiclibraryChordStaff",["dmusiclibraryNavigationService",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="chord-staff-container"><dmusiclibrary-staff class="has-context-menu" ng-context-menu="menuOptions" staff="staff.Staff" report="staff.Report" container-parent-class="\'chord-staff-container\'"></dmusiclibrary-staff></div>',scope:{chord:"=",staff:"="},link:function(b){b.chordName=b.chord.TitleChordName.FullName,b.menuOptions={onShow:null,items:[]},b.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+b.chordName,function(){a.goToVirtualCowriter(b.chordName+" Chord")}])}}}]).directive("dmusiclibraryChordLine",["dmusiclibraryNavigationService",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<div><span ng-show=!showDetails><span class="has-context-menu" ng-context-menu="menuOptions">{{text}}</span> <dmusiclibrary-midi-sound midi-sound="chord.ChordSound"></dmusiclibrary-midi-sound></span><div class="darker-well" ng-if="showDetails"><span class="glyphicon glyphicon-remove remove-icon" ng-click="removeClicked()"></span><dmusiclibrary-chord-basic-info chord="chord"></dmusiclibrary-chord-basic-info></div></div>',scope:{chord:"=",preferChordSymbol:"="},link:function(b){b.showDetails=!1,b.removeClicked=function(){b.showDetails=!1},b.$watch("chord",function(c){c&&(b.chordName=b.chord.TitleChordName.FullName,b.text=b.preferChordSymbol&&b.chord.ChordSymbol?b.chord.ChordSymbol.Name+" ("+b.chordName+")":b.chordName,b.menuOptions={onShow:null,items:[]},b.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+b.chordName,function(){a.goToVirtualCowriter(b.chordName)}]),b.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> as Scale",function(){a.goToVirtualCowriter(b.chordName+" Scale")}]),b.menuOptions.items.push(["Details",function(){b.showDetails=!0}]))})}}}]).directive("dmusiclibraryChordInversions",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><h5 style="font-weight: bolder;">Inversions and Slash Chords</h5><div ng-repeat="inversion in inversions"><dmusiclibrary-chord-line chord="inversion"></dmusiclibrary-chord-line></div></div>',scope:{chord:"=",inversions:"="},link:function(){}}}]).directive("dmusiclibraryVcChordChart",["$rootScope","dmusiclibraryNavigationService","dmusiclibraryVirtualCowriterService",function(a,b,c){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center" ng-click="chordChartClicked()" ><h4 style="margin-top: 0px;"><dmusiclibrary-tab-chord-name tab-chord="chordChart.TabChord"></dmusiclibrary-tab-chord-name> <dmusiclibrary-midi-sound midi-sound="chordChart.TabChord.Chord.ChordSound"></dmusiclibrary-midi-sound></h4><div><dmusiclibrary-note-name-list note-names="chordChart.TabChord.Chord.NoteNames"></dmusiclibrary-note-name-list> <dmusiclibrary-midi-sound midi-sound="chordChart.TabChord.Chord.NotesSound"></dmusiclibrary-midi-sound></div><div><dmusiclibrary-note-number-name-list note-number-names="chordChart.ChordFormula.NoteNumberNames"></dmusiclibrary-note-number-name-list></div><dmusiclibrary-chord-chart ng-if="ready" max-width="maxWidth" class="has-context-menu" ng-context-menu="menuOptions" chord-chart="chordChart.ChordChart"></dmusiclibrary-chord-chart><div>{{chordChart.ChordChart.GuitarType}}</div><div>{{chordChart.ChordChart.Properties.DifficultyTypeString}} - {{chordChart.ChordChart.Properties.DifficultyRating}}</div></div>',scope:{chord:"=",chordChart:"="},controller:["$scope",function(a){a.chordName=a.chord.TitleChordName.FullName,a.menuOptions={onShow:null,items:[]},a.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+a.chordChart.TabChord.Title,function(){b.goToVirtualCowriter(a.chordChart.TabChord.Title)}]),a.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> as Scale",function(){b.goToVirtualCowriter(a.chordChart.TabChord.Title+" Scale")}]),a.menuOptions.items.push(["View on Fretboard",function(){c.showChordOnFretboard(a.chordChart.TabChord,!0)}])}],link:function(a,b){a.maxWidth=b.width(),a.ready=!0,a.chordChartClicked=function(){c.showChordOnFretboard(a.chordChart.TabChord,!1)}}}}]).directive("dmusiclibraryChordCharts",["homeService","dmusiclibraryInstrumentService","dmusiclibraryChordService","dmusiclibraryVirtualCowriterService","$timeout","$compile","$rootScope",function(a,b,c,d,e,f){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><div class="vc-chord-chart-container"></div></div>',scope:{chord:"=",chordCharts:"=",displayChartsInRow:"=",suppressShowingFirstChartOnFretboard:"=",rowSize:"@",suppressPanels:"="},link:function(a,g){a.rowSize||(a.rowSize=3),a.renderChordCharts=function(){var b=$(g).find(".vc-chord-chart-container");if(b.empty(),a.chordCharts.length<=0||1==a.chordCharts.length&&null===a.chordCharts[0])return void b.append("<h3>No Chord Charts Found</h3>");a.suppressShowingFirstChartOnFretboard||d.showChordOnFretboard(a.chordCharts[0].TabChord,!1);var c=0,h=null,i=[],j=a.rowSize,k=function(){if(!(c>=a.chordCharts.length)){var d=a.chordCharts[c],g=a.displayChartsInRow?!1:i.length>=j;(g||null===h)&&(h=$('<div class="row'+(a.suppressPanels?"":" small-panel")+'" '+(a.displayChartsInRow?'style="white-space: nowrap; overflow-x: auto;"':"")+"></div>"),a.suppressPanels&&h.css("margin-top",20),b.append(h),i=[]),i.push(d);var l=a.$new(!0);l.chordChart=d,l.chord=a.chord;var m=f('<div class="col-md-'+12/j+" "+(a.displayChartsInRow?"chord-chart-panel":"")+'"><dmusiclibrary-vc-chord-chart chord-chart="chordChart" chord="chord"></dmusiclibrary-vc-chord-chart></div>')(l);h.append(m),c++,e(k,0)}};k()},a.renderChordCharts(),a.$on("instrumentChanged",function(){c.getChordCharts(a.chord,b.getChordChartOptions(),function(b){a.chordCharts=b.ChordCharts,a.chord.ChordCharts=a.chordCharts,a.renderChordCharts()},function(){console.error("Could not retrieve chord charts.")})})}}}]).directive("dmusiclibraryVcFretboard",["$timeout","dmusiclibraryVirtualCowriterService",function(a,b){return{restrict:"E",replace:!0,transclude:!0,template:'<div><div id="fretboard-container" ng-if="renderFretboard"><dmusiclibrary-instrument-fretboard clearFretsButton="false" options="fretboardOptions"></dmusiclibrary-instrument-fretboard></div></div>',scope:{tabChord:"=?"},link:function(c){c.fretboardOptions={isChordMode:!0,fretboardConfig:{noteClickingDisabled:!0}},a(function(){c.renderFretboard=!0,c.tabChord&&a(function(){b.showChordOnFretboard(c.tabChord,!1)},0)},0)}}}]).directive("dmusiclibraryChordName",["dmusiclibraryNavigationService",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<span class="has-context-menu" ng-context-menu="menuOptions">{{chordName}}</span>',scope:{chordName:"="},link:function(b){b.menuOptions={onShow:null,items:[]},b.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+b.chordName,function(){a.goToVirtualCowriter(b.chordName+" Chord")}]),b.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> as Scale",function(){a.goToVirtualCowriter(b.chordName+" Scale")}])}}}]).directive("dmusiclibraryChordBasicInfo",["navigationService","dmusiclibraryVirtualCowriterService",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="text-center"><h3 style="margin-top: 0px; font-weight: bolder;"><dmusiclibrary-chord-name chord-name="chord.TitleChordName.FullName"></dmusiclibrary-chord-name> <dmusiclibrary-midi-sound midi-sound="chord.ChordSound"></dmusiclibrary-midi-sound></h3><h5 ng-show="chord.ChordSymbol" style="font-weight: bolder;">{{chord.ChordSymbol.Name}}</h5><h5 style="font-weight: bolder;"><dmusiclibrary-note-name-list note-names="chord.NoteNames"></dmusiclibrary-note-name-list> <dmusiclibrary-midi-sound midi-sound="chord.NotesSound"></dmusiclibrary-midi-sound></h5><h5 style="font-weight: bolder;"><dmusiclibrary-note-number-name-list note-number-names="chord.ChordFormula.NoteNumberNames"></dmusiclibrary-note-number-name-list></h5></div>',scope:{chord:"="},link:function(){}}}]).directive("dmusiclibraryNoteNameList",["dmusiclibraryNavigationService","dmusiclibraryVirtualCowriterService",function(a,b){return{restrict:"E",replace:!0,transclude:!0,template:'<span class="has-context-menu" ng-context-menu="menuOptions">{{text}}</span>',scope:{noteNames:"="},link:function(c){c.$watch("noteNames",function(d){d&&(c.text=b.getNoteNameString(c.noteNames),c.searchText=b.getNoteNameString(c.noteNames,!0)),c.menuOptions={onShow:null,items:[]},c.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+c.text,function(){a.goToVirtualCowriter(c.searchText)}]),c.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> as Chord",function(){a.goToVirtualCowriter(c.searchText+" Chord")}]),c.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> as Scale",function(){a.goToVirtualCowriter(c.searchText+" Scale")}])})}}}]).directive("dmusiclibraryNoteNumberNameList",["dmusiclibraryNavigationService","dmusiclibraryVirtualCowriterService",function(a,b){return{restrict:"E",replace:!0,transclude:!0,template:'<span class="has-context-menu" ng-context-menu="menuOptions">{{text}}</span>',scope:{noteNumberNames:"="},link:function(c){c.$watch("noteNumberNames",function(d){d&&(c.text=b.getNoteNumberNameString(c.noteNumberNames),c.menuOptions={onShow:null,items:[]},c.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon> "+c.text,function(){a.goToVirtualCowriter(c.text)}]),c.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon>  as Chord",function(){a.goToVirtualCowriter(c.text+" Chord")}]),c.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon>  as Scale",function(){a.goToVirtualCowriter(c.text+" Scale")}]),c.menuOptions.items.push(["<dmusiclibrary-search-icon></dmusiclibrary-search-icon>  as Chord Progression",function(){a.goToVirtualCowriter(c.text+" Chord Progression")}]))})}}}]).directive("dmusiclibraryChordChart",["uiService","dmusiclibraryInstrumentService",function(a,b){return{restrict:"E",replace:"true",transclude:!0,template:'<div class="chordChart"><canvas class="chordCanvas" style="display: none;"></canvas><img class="chordCanvasImage" alt="Chord Chart"></div>',scope:{chordChart:"=",maxWidth:"="},link:function(c,d){for(var e=c.chordChart,f=[],g=0;g<e.StringNoteNames.length;g++)f.push(e.StringNoteNames[g].Name);var h=f.length<=4?200:150,i=27*e.FretCount;h>i&&(i=h);var j=f.length<=4?30*f.length:24*f.length,k=$(d),l=k.find(".chordCanvas"),m=k.find(".chordCanvasImage");c.maxWidth&&(j>c.maxWidth&&(j=c.maxWidth),k.width(j),d.css("margin-left",-10));var n=50,o=i+(angular.isDefined(e.Title)&&null!==e.Title?40:20),p=j+n,q="(",r=[];for(g=0;g<e.FretsPerString.length;g++){var s=e.FretsPerString[g],t=angular.isDefined(s.FretIndex)&&null!==s.FretIndex?s.IsOpenFret?0:s.FretIndex:"x";q+=t.toString(),r.push([s.StringIndex,t,s.Finger])}q+=")";var u=[];for(g=0;g<e.Bars.length;g++){var v=e.Bars[g];u.push({from_string:v.FromStringIndex,to_string:v.ToStringIndex,fret:v.Fret})}var w=(p-j)/2,x=5,y=l[0],z=m[0],A=a.createHiDefContext(p,o,2.5,y,null,z),B=new ChordBox(a,A,w,x,j,i,f.length,e.FretCount);B.setChord(r,e.AbsoluteChartFretPosition,e.FretAtWhichToDrawPositionText,e.AbsoluteChartFretPosition,u,f,e.Title),B.draw();var C=B.paper.canvas,D=C.toDataURL();z.src=D;var E=q+" - "+b.getShortNameOfCurrentInstrument()+(angular.isDefined(e.Title)&&" - "+e.Title!==null?e.Title:"");z.alt=E}}}]).directive("dmusiclibrarySearchIcon",[function(){return{restrict:"E",replace:!0,template:'<span class="glyphicon glyphicon-search"></span>',link:function(){}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryBazzleService",["$rootScope","$timeout","$route","commService","homeService","dmusiclibraryInstrumentService","navigationService","OPTIONS","dmusiclibraryVirtualCowriterService","dmusiclibraryCommService","dmusiclibraryNavigationService",function(a,b,c,d,e,f,g,h,i,j,k){return{observerCallbacks:{global:[],textElements:[]},registerCallback:function(a){this.observerCallbacks.global.push(a)},registerTextElementCallback:function(a){this.observerCallbacks.textElements.push(a)},notifyGlobalObservers:function(){for(var a=0;a<this.observerCallbacks.global.length;a++)this.observerCallbacks.global[a]()},notifyTextElementObservers:function(){for(var a=0;a<this.observerCallbacks.textElements.length;a++)this.observerCallbacks.textElements[a]()},raiseSelectionChanged:function(){this.notifyGlobalObservers(),this.notifyTextElementObservers()},selectionOptions:{selectedTextElements:[],isSelecting:!1},onSelecting:function(){this.raiseSelectionChanged()},onNotSelecting:function(){this.raiseSelectionChanged()},clearSelection:function(){this.selectionOptions.isSelecting=!1,this.selectionOptions.selectedTextElements=[],this.onNotSelecting()},prepareForNewCommandResults:function(){this.selectionOptions.isSelecting=!1,this.selectionOptions.selectedTextElements=[],this.observerCallbacks.textElements=[],this.raiseSelectionChanged()},toggleSelecting:function(){this.selectionOptions.isSelecting?this.stopSelecting():this.beginSelecting()},beginSelecting:function(){this.observerCallbacks.textElements.length<=0&&c.reload(),this.selectionOptions.isSelecting=!0,this.onSelecting()},stopSelecting:function(){this.clearSelection()},selectTextElement:function(a){this.selectionOptions.isSelecting=!0,this.selectionOptions.selectedTextElements.push(a),this.notifyGlobalObservers(),this.notifyTextElementObservers()},unselectTextElement:function(a){for(var b=-1,c=0;c<this.selectionOptions.selectedTextElements.length;c++)if(this.selectionOptions.selectedTextElements[c]===a){b=c;break}b>=0&&this.selectionOptions.selectedTextElements.splice(b,1),this.onSelecting()},executeTextElementCommand:function(a){var b="";if(a){for(var c=0;c<this.selectionOptions.selectedTextElements.length;c++){var d=this.selectionOptions.selectedTextElements[c],e=this.getTextFromTextElement(d);b+=e+(c+1<this.selectionOptions.selectedTextElements.length?", ":"")}"Convert"===a.type&&"ChordProgression"!==a.target&&(b+=" as "+a.target)}else{var f=this.getRootSelectedTextElement();b=this.getTextFromTextElement(f)}k.goToBazzle(b)},getTextElementCommandsForSelectedTextElement:function(){var a=this.getRootSelectedTextElement();if(!a)return[];var b=this.isTextElementConvertibleToChordProgression(a),c=this.isTextElementConvertibleToChord(a),d=this.isTextElementConvertibleToScale(a),e=this.isTextElementConvertibleToTab(a),f=[];return c&&f.push({text:"As Chord(s)",type:"Convert",target:"Chord"}),b&&f.push({text:"As Chord Progression",type:"Convert",target:"ChordProgression"}),d&&f.push({text:"As Scale(s)",type:"Convert",target:"Scale"}),e&&f.push({text:"Get Chord Charts",type:"Convert",target:"Tab"}),f},getTextFromTextElement:function(a){return"Text"===a.ObjectType&&angular.isDefined(a.Object)&&null!==a.Object&&"string"==typeof a.Object?a.Object.toString():a.Text},getRootSelectedTextElement:function(){return this.selectionOptions.selectedTextElements.length<=0?null:this.selectionOptions.selectedTextElements[0]},isTextElementConvertibleToChordProgression:function(a){return this.isTextElementConvertibleToChord(a)},isTextElementConvertibleToChord:function(a){return"ChordAsSeriesOfNotes"===a.ElementType||"ChordName"===a.ElementType||"Chord"===a.ElementType||"ScaleAsSeriesOfNotes"===a.ElementType||"Tab"===a.ElementType||"ChordProgression"===a.ElementType||"NoteNumberNameProgression"===a.ElementType||"ChordNameElement"===a.ElementType||"ChordNameElementProgression"===a.ElementType},isTextElementConvertibleToScale:function(a){return"ChordAsSeriesOfNotes"===a.ElementType||"ChordName"===a.ElementType||"Chord"===a.ElementType||"ChordNameElement"===a.ElementType||"Chord"===a.ElementType||"ScaleAsSeriesOfNotes"===a.ElementType||"Scale"===a.ElementType||"ScaleDefinition"===a.ElementType||"NoteNumberNameProgression"===a.ElementType},isTextElementConvertibleToTab:function(a){return"Tab"===a.ElementType||"TabProgression"===a.ElementType||"ChordAsSeriesOfNotes"===a.ElementType||"ChordName"===a.ElementType||"Chord"===a.ElementType||"ChordNameElement"===a.ElementType||"Chord"===a.ElementType||"ScaleAsSeriesOfNotes"===a.ElementType||"ChordNameElementProgression"===a.ElementType||"ChordProgression"===a.ElementType},isTextElementSelectable:function(a){if("Other"===a.ElementType)return!1;var b=this.getRootSelectedTextElement();if(!b)return!0;var c=this.isTextElementConvertibleToChord(a),d=this.isTextElementConvertibleToScale(a);return"Chord"===b.ElementType||"ChordName"===b.ElementType||"ChordAsSeriesOfNotes"===b.ElementType||"ChordNameElement"===b.ElementType?c:"ChordProgression"===b.ElementType||"ChordNameElementProgression"===b.ElementType?c:"NoteNumberNameProgression"===b.ElementType?c||d:"Scale"===b.ElementType||"ScaleDefinition"===b.ElementType||"ScaleAsSeriesOfNotes"===b.ElementType?d:"Tab"===b.ElementType||"TabProgression"===b.ElementType?this.isTextElementConvertibleToTab(a):"ChordSymbol"===b.ElementType?"ChordSymbol"===a.ElementType:"Instrument"===b.ElementType?"Instrument"===a.ElementType:!1},lastCommand:null,results:null,clearAllFilters:function(a){var b=this.results[a];if(b.filters)for(var c=0;c<b.filters.length;c++){var d=b.filters[c];d.currentValue=null,this.raiseResultEvent(a)}},subscribeAndHandleFilters:function(a,b,c,d){if(a&&a.length>0){var e=this;this.subscribeToResultEvents(b,function(){c();var f=!0,g=e.getFilters(b);if(g)for(var h=0;h<g.length;h++){var i=g[h];if(null!==i.currentValue&&""!==i.currentValue){for(var j=0;j<a.length;j++){var k=a[j];k.FilterName===i.FilterName&&k.FilterValue!==i.currentValue&&(d(),f=!1)}if(!f)break}}})}},raiseResultEvent:function(a){var b=this.results[a];if(b.observerCallbacks)for(var c=0;c<b.observerCallbacks.length;c++)b.observerCallbacks[c]()},subscribeToResultEvents:function(a,b){var c=this.results[a];c.observerCallbacks||(c.observerCallbacks=[]),c.observerCallbacks.push(b)},getFilters:function(a){var b=this.results[a];return b.filters},applyFilter:function(a,b,c){var d=this.results[c];d.filters||(d.filters=[]),a.currentValue=b,d.filters.push(a),this.raiseResultEvent(c)},setScopeResults:function(a,c,d){a.showLoading=!0,g.goToTop();var e=this;e.prepareForNewCommandResults(),a.results=c.Results,e.results=a.results,a.excludedFormulas=c.ExcludedFormulas,d&&d(),b(function(){a.$parent&&(a.showLoading=!1,window.prerenderReady=!0)},0)},executeAndSetScopeResults:function(a,b){var c=this;g.goToTop(),d.showInfoAlert("When we receive the results, we'll begin printing them! If the spinner stops spinning, we're printing as you read!",{onlyIfUnique:!0}),this.execute(a,function(d){c.setScopeResults(a,d,b)},function(b){a.results=null,b&&d.showErrorAlert(b.ErrorReason)})},execute:function(b,c,d){var g=b.form.command;this.lastCommand=g;var k=this,l=i.getParserOptions(),m=function(){j.postWithParams("parser",{RequestType:"Execute",Command:g,IsDebug:h.isDebug,ParserOptions:l},function(a){if(c){k.prepareForNewCommandResults();for(var b=a.Result,d=b.FormulaResults,f=0;f<d.length;f++){var g=d[f],i=g.Panes;if(i.length<=2)for(var j=0;j<i.length;j++)("Small"===i[j].Size||"Medium"===i[j].Size)&&(i[j].Size="Large");var l=4e3;g.rows=e.columnizeList(g.Panes,l)}c({Results:d,ExcludedFormulas:h.isProduction?null:b.ExcludedFormulas})}},function(a){d&&d(a)})};f.initialized?m():a.$on("instrumentServiceInitialized",function(){m()})}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryChordGridService",["$rootScope","dmusiclibraryMidiService",function(a,b){return{progChordElements:{},progression:[],registerMe:function(a,b){var c=b.$$hashKey;this.progChordElements[c]=a},deleteMe:function(a){var b,c,d=this.progression;for(b=0;b<d.length;b++)c=d[b].$$hashKey,c===a.$$hashKey&&(d=d.splice(b,1),delete this.progChordElements[c])},getGridHelper:function(a){var b=this,c={getQuarterNotesByWidth:function(a){return a/this.getWidthPerQuarterNote()},getUnitsPerQuarterNote:function(){return a.chordGridOptions.unitsPerQuarterNote},getChordNumberOfQuarterNotes:function(a){return a?a/this.unitsPerQuarterNote:this.quarterNotesPerMeasure},getUnitsByWidth:function(b){return this.getQuarterNotesByWidth(b)*a.chordGridOptions.unitsPerQuarterNote},setGridDivisions:function(){var c,d,e,f,g,h,i,j=a.chordGridOptions.timeSignature.Numerator,k=1,l=this.unitsPerQuarterNote;angular.forEach(b.progression,function(m){for(g=b.progChordElements[m.$$hashKey],f=m.units/l,numDivisions=a.chordGridOptions.timeSignature.Denominator*f/4,h=g.height(),i=g.width(),g.find(".grid-division").remove(),e=1;e<=numDivisions;e++)d=k%j===0?"chord-boundary":"chord-middle",k++,c=$("<div class='grid-division'></div>").addClass(d),c.height(h).offset({left:e/numDivisions*i,top:0}),g.append(c)})},getWidthPerQuarterNote:function(){return $chordWidthTestEl.width()},computeGridVars:function(){this.unitsPerQuarterNote=this.getUnitsPerQuarterNote(),this.widthPerQuarterNote=this.getWidthPerQuarterNote(),this.quarterNotesPerMeasure=4*a.chordGridOptions.timeSignature.Numerator/a.chordGridOptions.timeSignature.Denominator,this.measureWidth=this.quarterNotesPerMeasure*this.widthPerQuarterNote,this.gridUnit=this.measureWidth/a.chordGridOptions.timeSignature.Numerator,this.snapThreshold=a.chordGridOptions.snapThreshold
},executeClickCallback:function(b){return angular.isFunction(a.chordGridOptions.clickCallback)?void a.chordGridOptions.clickCallback(b):(console.log("The callback is not a function: "),void console.log(a.chordGridOptions.callback))}};return c},getSortableOptions:function(a,c,d,e){var f=[],g={connectWith:".chord-grid-container",start:function(e,g){var h=$(".ui-sortable-placeholder");h.width(g.item.width()),h.height(g.item.height()),f=$.extend(!0,[],a.chordChoices),angular.forEach(f,function(a){delete a.$$hashKey});var i=c(a)[g.item.sortable.index];b.playSound(i.ChordSound,{},function(){}),d&&d(i,g.item,e);var j=$(".chord-grid-chords");j.css("width",j.width()),j.css("height",j.height())},stop:function(b,d){var g=$(".chord-grid-chords");g.css("width",""),g.css("height","");var h=b&&b.target&&$(b.target),i=d&&d.item&&d.item.sortable&&d.item.sortable.droptarget;if(h&&h.hasClass("chord-grid-chords")&&i&&i.hasClass("progression")&&(a.chordChoices=$.extend(!0,[],f)),e){var j=function(a,b){var c=0,d=0;return c=b.left-a.left,c*=c,d=b.top-a.top,d*=d,Math.sqrt(c+d)},k=c(a)[d.item.sortable.index];j(d.position,d.originalPosition)<=10&&e(k,d.item,b)}},update:function(a,b){var c=b&&b.item&&b.item.sortable,d=c&&c.droptarget;d&&d.hasClass("chord-grid-chords")&&c.cancel()},activate:function(){},"ui-floating":!0,revert:!0,tolerance:"pointer",helper:"clone",distance:0};return g}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryChordProgressionGeneratorService",["$rootScope","$http","commService","dmusiclibraryScaleService","dmusiclibraryInstrumentService","dmusiclibraryMidiService","dmusiclibraryCommService",function(a,b,c,d,e){return{chordColors:["green","orange","yellow","MediumOrchid ","lightblue","tan","brown","pink","LightSeaGreen","LawnGreen","MediumSlateBlue","PaleGoldenRod","PowderBlue"],assignChordColors:function(a){for(var b=0;b<a.length;b++)a[b].color=this.chordColors[b]},filterByChordCharacteristicCategoryValue:function(a,b,c){for(var d={Key:a.Key,Chords:[],ChordCharacteristicsExtrema:a.ChordCharacteristicsExtrema},e=0;e<a.Chords.length;e++){var f=a.Chords[e],g=b(f.ChordCharacteristics);g.ClusterIndex===c&&d.Chords.push(f)}return d},getChordChoices:function(b,c,f,g){var h=[],i=[],j=this,k=function(){var a=function(a){for(var b=[],c=0;c<a.Chords.length;c++){var d=a.Chords[c];if(d.length>0){var e=d[0];e.name=e.TitleChordName.FullName,b.push(e)}}return j.assignChordColors(b),b};d.harmonize(b,null,{HarmonizeAtAllChromaticIndexes:!0,ChordDistances:3,ChordSize:3},function(b){h=a(b.HarmonizedChords),c(h)},g),d.harmonize(b,null,{HarmonizeAtAllChromaticIndexes:!0,ChordDistances:3,ChordSize:4},function(b){i=a(b.HarmonizedChords),f(i)},g)};e.initialized?k():a.$on("instrumentServiceInitialized",function(){k()})}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryChordService",["$rootScope","$http","commService","dmusiclibraryVirtualCowriterService","dmusiclibraryInstrumentService","dmusiclibraryCommService",function(a,b,c,d,e,f){return{getInversions:function(a,b,c,e){f.postWithParams("chord",{RequestType:"Inversions",Chord:a,ParserOptions:d.getParserOptions(),InversionOptions:b},c,e)},getNotation:function(a,b,c){f.postWithParams("chord",{RequestType:"Notation",Chord:a},b,c)},getChordCharts:function(a,b,c,e){f.postWithParams("chord",{RequestType:"ChordCharts",Chord:a,ParserOptions:d.getParserOptions(),ChordChartOptions:b},c,e)},fillChordData:function(a,b){this.getNotation(a,function(b){a.Staff=b.Staff},function(){}),this.getInversions(a,{AllowSlashChords:!0},function(b){a.inversions=b.Inversions},function(){});var c=e.getChordChartOptions();b&&(c=angular.extend(c,b)),this.getChordCharts(a,c,function(b){a.ChordCharts=b.ChordCharts,a.ChordCharts.length<=0&&a.ChordCharts.push(null)},function(){})},getVoicings:function(a,b,c,e){f.postWithParams("chord",{RequestType:"Voicings",Chord:a,ParserOptions:d.getParserOptions(),ChordVoicingsOptions:b},c,e)},getChordDestinations:function(a,b,c,e){f.postWithParams("chord",{RequestType:"Destinations",Chord:a,ParserOptions:d.getParserOptions(),ChordDestinationOptions:b},c,e)},getChordSources:function(a,b,c,e){f.postWithParams("chord",{RequestType:"Sources",Chord:a,ParserOptions:d.getParserOptions(),ChordSourceOptions:b},c,e)},getChordSubstitutions:function(a,b,c,e){f.postWithParams("chord",{RequestType:"Substitutions",Chord:a,ParserOptions:d.getParserOptions(),ChordSubstitutionOptions:b},c,e)},getDefaultChordDirectionalityOptions:function(a,b){return{Keys:a,MinChordSize:3,MaxChordSize:4,MaxMovementInHalfSteps:3,ExcludeSusChords:!0,MinUniqueNoteNames:3,MustHaveSecondThirdOrFourth:!0,UseChordProgressionFormulas:b,ExcludeExtensions:!0,GatherChordCharacteristics:!0}},getDefaultChordSubstitutionOptions:function(a){return{Key:a,SubstitutionMustShareCharacteristicTones:!0,EnforceOctaveMatchForSubstitution:!1,MinChordSize:3,MaxChordSize:4,MaxMovementInHalfSteps:3}},generateChords:function(a,b,c,e,g,h,i,j,k){j||(j=this.getDefaultChordDirectionalityOptions(null,g)),k||(k=this.getDefaultChordSubstitutionOptions()),f.postWithParams("chord",{RequestType:"GenerateChords",ParserOptions:d.getParserOptions(),GenerateChordOptions:{PreviousChord:a,ChordToReplace:b,NextChord:c,Key:e,ChordDirectionalityOptions:j,ChordSubstitutionOptions:k}},h,i)}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryCommService",["$rootScope","commService",function(a,b){return{getServiceUrl:function(){return b.getDomain()+":"+b.getPort()+"/MusicLibraryService"},postWithParams:function(a,c,d,e){return b.postWithParams(a,c,d,e,{url:this.getServiceUrl()})}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryFretboardJsService",["$rootScope","dmusiclibraryInstrumentService","$q",function(a,b,c){function d(a){return angular.isNumber(a.noteOctave)&&angular.isNumber(j[a.noteLetter])?12*a.noteOctave+j[a.noteLetter]:-1}function e(a,b){return d(a)-d(b)}function f(a){return g().then(function(b){return{clickedNotes:[],fretboardOrigin:[35,20],numFrets:16,fretWidth:63,fretHeight:35,isChordMode:a,noteClickingDisabled:!1,tuningClickingDisabled:!0,guitarStringNotes:b,clickedNoteCircColor:"#3276b1",clickedNoteTextColor:"white",hoverNoteCircColor:"white",hoverNoteTextColor:"black",fretboardColor:"wheat",stringColor:"black",tuningTriangleColor:"lightgray",fretsToDrawOneCircleOn:[3,5,7,9,12],opacityAnimateSpeed:200,showTuningTriangles:!1,showTuningSquares:!0,tuningSquaresColor:"#3276b1",tuningSquaresTextColor:"white",nutColor:"black"}})}function g(){var d=c.defer();return b.initialized?d.resolve(h()):a.$on("instrumentServiceInitialized",function(){d.resolve(h())}),d.promise}function h(){var a=b.instrument&&b.instrument.Tuning&&b.instrument.Tuning.Notes,c=[];return a&&a.forEach(function(a){a&&a.Name&&a.OctaveNumber&&c.push({noteLetter:a.Name,noteOctave:a.OctaveNumber})}),c.reverse()}var i={"Ab/G#":"Ab","A#/Bb":"Bb","C#/Db":"C#","D#/Eb":"Eb","F#/Gb":"F#"},j={C:0,Db:1,"C#":1,"Db/C#":1,"C#/Db":1,D:2,Eb:3,"D#":3,"Eb/D#":3,"D#/Eb":3,E:4,F:5,Gb:6,"F#":6,"Gb/F#":6,"F#/Gb":6,G:7,Ab:8,"G#":8,"Ab/G#":8,"G#/Ab":8,A:9,"A#":10,Bb:10,"A#/Bb":10,"Bb/A#":10,B:11};return{getDefaultFretboardConfig:f,getTuning:g,mapFromFretboardJsNoteToBazzleNote:i,noteSortLowToHigh:e,getTabStringFromFretboard:function(a,b){var c=null;return(c=a?function(){var a,c,d={},e="";return b&&b.clickedNotes&&b.guitarStringNotes&&(a=angular.copy(b.clickedNotes),c=angular.copy(b.guitarStringNotes),a.reverse(),c.reverse(),c.forEach(function(a){a&&a.noteLetter&&angular.isNumber(a.noteOctave)&&(d[a.noteLetter+a.noteOctave]="x")}),a.forEach(function(a){a&&angular.isNumber(a.fretNumber)&&a.stringItsOn&&a.stringItsOn.noteLetter&&angular.isNumber(a.stringItsOn.noteOctave)&&(d[a.stringItsOn.noteLetter+a.stringItsOn.noteOctave]=a.fretNumber)}),angular.forEach(d,function(a){e+=a+"-"}),"-"===e[e.length-1]&&(e=e.substring(0,e.length-1))),e}:function(){var a,c={},d="";return b&&b.clickedNotes&&(a=angular.copy(b.clickedNotes),a.sort(e),a.forEach(function(a){if(a&&a.noteLetter&&angular.isNumber(a.noteOctave)){var b=(i[a.noteLetter]||a.noteLetter)+a.noteOctave;c[b]=!0}}),angular.forEach(c,function(a,b){d+=b+","}),","===d[d.length-1]&&(d=d.substring(0,d.length-1))),d})()},addScaleToFretboard:function(a,b){for(var c=b.TabScale,d=0;d<c.Notes.length;d++){var e=c.Notes[d];this.addNoteToFretboard(a,e.StringIndex,e.FretIndex,e.Note)}},addChordToFretboard:function(a,b){for(var c=b.Chord.NoteNames,d=0,e=0;e<b.FretsPerString.length;e++){var f=b.FretsPerString[e];if(null!==f){if(!this.addNoteToFretboard(a,e,f,c[d]))break;d++}}},addNoteToFretboard:function(a,c,d,e){if(a.clickedNotes||(a.clickedNotes=[]),c>=b.instrument.Tuning.Notes.length)return!1;var f=b.instrument.Tuning.Notes[c];return a.clickedNotes.push({fretNumber:d,noteLetter:e.Name,noteOctave:e.OctaveNumber,stringItsOn:{noteLetter:f.Name,noteOctave:f.OctaveNumber}}),!0}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryInstrumentService",["$rootScope","$http","$modal","$routeParams","$location","commService","navigationService","dmusiclibraryCommService",function(a,b,c,d,e,f,g,h){return{tabOptions:{AllowDifficultBars:!1,PreferNoBarChords:!0,UseThumb:!1},tabSearchParameters:{AllowInversions:!1},getChordChartOptions:function(){return{TabSearchParameters:this.tabSearchParameters}},editInstrumentOptions:{sourcePath:null},basicGuitars:[],guitarTypes:[],instrumentCombinations:[],standardGuitar:null,instrument:null,initialized:!1,isInstrument:function(a){return a&&a.Fretboard&&angular.isDefined(a.Fretboard.IsCustom)},getShortNameOfCurrentInstrument:function(){return(this.instrument.Fretboard.IsCustom||this.instrument.Tuning.IsCustom?"Custom ":"")+this.instrument.GuitarType},getNameOfCurrentInstrument:function(){return this.getInstrumentName(this.instrument)},loadInstrumentFromUrl:function(){if(d.instrument&&"null"!==d.instrument&&this.isInstrumentJson(d.instrument)){var a;try{a=angular.fromJson(d.instrument),this.isInstrument(a)&&this.setInstrument(a)}catch(b){}}},setInstrumentFromName:function(a,b,c){var d=this;this.getInstrumentFromName(a,function(a){a.Instruments&&a.Instruments.length>0?d.setInstrument(a.Instruments[0]):d.setInstrumentToGuitar(),b&&b(a)},c)},loadInstrumentNameFromRouteParams:function(b,c){if(d.instrument){if(this.isInstrumentJson(d.instrument))return;var e=this,g=function(){f.hideLoading(),f.showWarningAlert("Your instrument is being changed to "+d.instrument+"."),e.setInstrumentFromName(d.instrument,b,c)};f.showLoading(),this.initialized?g():a.$on("instrumentServiceInitialized",function(){g()})}},isInstrumentJson:function(){try{return angular.fromJson(d.instrument),!0}catch(a){return!1}},addInstrumentToUrl:function(){return this.instrument&&(e.replace(),JSON.stringify(this.instrument)!==e.$$search.instrument)?(e.search("instrument",JSON.stringify(this.instrument)),!0):!1},getInstrumentName:function(a){if(a.Fretboard.IsCustom&&(a.Fretboard.Name="Custom "+a.Fretboard.StringFretBounds.length+"-String "+a.GuitarType),a.Tuning.IsCustom){a.Tuning.Name="";for(var b=0;b<a.Tuning.Notes.length;b++){var c=a.Tuning.Notes[b];b>0&&(a.Tuning.Name+=" "),a.Tuning.Name+=c.Name+c.OctaveNumber}}var d="";return a.Capo&&(d+=" Capo at "+a.Capo.Fret,!a.Capo.CoverAllStrings&&a.Capo.StringsCovered<a.Fretboard.StringFretBounds.length&&(d+=" covering "+a.Capo.StringsCovered+" strings from "+(a.Capo.LowToHighStrings?"low to high.":"high to low."))),(a.IsLeftHanded?"Left-Handed  ":"")+a.Fretboard.Name+' (Tuning: "'+a.Tuning.Name+'")'+d},getInstrumentBasicName:function(a){return a.GuitarType+" "+a.Tuning.Name},setInstrument:function(b,c){this.instrument=b,this.instrument.Name||(this.instrument.Name=this.getInstrumentName(this.instrument)),a.$emit("instrumentChanged",{instrument:this.instrument,sender:c}),a.$broadcast("instrumentChanged",{instrument:this.instrument,sender:c})},setInstrumentToGuitar:function(){this.setInstrument(this.standardGuitar)},finishedEditInstrument:function(a){this.editInstrumentOptions.sourcePath?a.goToPath(this.editInstrumentOptions.sourcePath):a.go("bazzle")},goToEditInstrument:function(){this.editInstrumentOptions.sourcePath=e.$$path,g.go("instrument-settings")},getInstrumentFromInstrumentCombination:function(a,b,c){var d={Fretboard:b,IsLeftHanded:!1,InstrumentType:a.InstrumentType,GuitarType:a.GuitarType,Tuning:c};return d.Name=this.getInstrumentName(d),d.BasicName=this.getInstrumentBasicName(d),d},initialize:function(b,c){var d=this;h.postWithParams("instrument",{},function(c){d.instrumentCombinations=c.InstrumentCombinations,d.standardGuitar=c.StandardGuitar,d.initialized=!0,d.guitarTypes=[];for(var e=0;e<d.instrumentCombinations.length;e++){for(var f=!1,g=0;g<d.guitarTypes.length;g++)if(d.guitarTypes[g]===d.instrumentCombinations[e].GuitarType){f=!0;break}f||d.guitarTypes.push(d.instrumentCombinations[e].GuitarType)}for(e=0;e<d.instrumentCombinations.length;e++){var h=d.instrumentCombinations[e],i=h.FretboardAndTunings[0],j=i.Fretboard,k=[i.Tunings[0]];if("Guitar"===h.GuitarType)for(var l=0;l<i.Tunings.length;l++)"Drop D"===i.Tunings[l].Name&&k.push(i.Tunings[l]);for(var m=0;m<k.length;m++){var n=k[m];d.basicGuitars.push(d.getInstrumentFromInstrumentCombination(h,j,n))}}b&&b(),a.$emit("instrumentServiceInitialized",[]),a.$broadcast("instrumentServiceInitialized",[])},c)},getInstrumentFromName:function(a,b,c){h.postWithParams("instrument",{InstrumentName:a},b,c)},getMaxFret:function(){for(var a=0,b=0;b<this.instrument.Fretboard.StringFretBounds.length;b++){var c=this.instrument.Fretboard.StringFretBounds[b];c.EndingFret>a&&(a=c.EndingFret)}return a}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryMidiService",["$rootScope","$http","$timeout","dmusiclibraryInstrumentService",function(a,b,c,d){return{instrumentsLoaded:[],instrumentMap:{Banjo:"banjo",Guitar:"acoustic_guitar_nylon",Bass:"acoustic_bass"},initialize:function(){var b=this;a.$on("instrumentChanged",function(){c(function(){b.loadMidiInstrument(d.instrument.GuitarType)},0)})},getMidiInstrument:function(a){var b=this.instrumentMap[a];return b||(b="acoustic_grand_piano"),b},loadMidiInstrument:function(a,b){for(var c=this.getMidiInstrument(a),d=!1,e=0;e<this.instrumentsLoaded.length;e++)if(this.instrumentsLoaded[e]===c){d=!0,b&&b();break}var f=this;d||(f.instrumentsLoaded.push(c),MIDI.loadPlugin({soundfontUrl:"sites/musiclibrary/sound-fonts/",instrument:c,callback:function(){b&&b()}}))},getBeatDuration:function(a){var b=a/6e4;return 1/b},getUnitDuration:function(a,b){var c=this.getBeatDuration(a);return c/(512/b.Denominator)},getMidiSoundFromChordProgression:function(a,b){for(var c=b.duration?null:this.getUnitDuration(b.tempo,b.timeSignature),d={StandardChromaticOctavesBelowA0:a[0].ChordSound.StandardChromaticOctavesBelowA0,GuitarType:a[0].ChordSound.GuitarType,TotalDuration:0,Chords:[]},e=0;e<a.length;e++){for(var f=a[e],g=f.ChordSound,h=b.duration?b.duration:f.units*c,i=0;i<g.Chords.length;i++){for(var j=g.Chords[i],k=0;k<j.Notes.length;k++){var l=j.Notes[k];l.Duration=h}j.LongestDuration=h,d.Chords.push(j)}d.TotalDuration+=h*g.Chords.length}return d},stop:function(){MIDI.stopAllNotes(),MIDI.Player.stop()},playChord:function(a){this.playSound(a.ChordSound)},playSound:function(a,b,e){b||(b={}),b.playing=!0;var f="0",g=MIDI.pianoKeyOffset,h=d.instrument.GuitarType,i=this.getMidiInstrument(h),j=0;"Banjo"===h?(f="",g=10521,j=-9):"Guitar"===h?"acoustic_guitar_steel"===i?(f="",g=2521,j=-9):"acoustic_guitar_nylon"===i&&(f="",g=2421,j=-9):"Bass"===h?"acoustic_bass"===i?(f="",g=3221,j=-9):"electric_bass_finger"===i&&(f="",g=3321,j=-9):j=-9;var k=function(){var d=!1;c(function(){!d&&e&&e()},a.TotalDuration),MIDI.setVolume(0,127);var h=function(b){for(var c=0;c<b.Notes.length;c++){var d=b.Notes[c],e=d.ChromaticIndex+g+j-12*a.StandardChromaticOctavesBelowA0,h=f+""+e;MIDI.noteOn(0,h,d.Velocity,0),MIDI.noteOff(0,h,d.Duration)}},i=0,k=function(){if(!b.playing)return void(e&&e());if(i<a.Chords.length){var d=a.Chords[i];h(d),i++,c(function(){k()},d.LongestDuration)}};k()};this.loadMidiInstrument(a.GuitarType,function(){k()})}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryNavigationService",["navigationService","communityService","$window","$routeParams",function(a,b,c,d){return{appendCommand:function(a,b,d){return b&&(a+="/"+c.encodeURIComponent(b),d&&(a+="/"+c.encodeURIComponent(d))),a},goToBazzle:function(c,d){var e=a.getToolUrl(b.community,"bazzle");e=this.appendCommand(e,c,d),a.goToPath(e)},goToVirtualCowriter:function(c,d){var e=a.getToolUrl(b.community,"vc");e=this.appendCommand(e,c,d),a.goToPath(e)},getCommandFromRoute:function(){return d.toolRouteData1?c.decodeURIComponent(d.toolRouteData1):null},getInstrumentFromRoute:function(){return d.toolRouteData2?c.decodeURIComponent(d.toolRouteData2):null}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryNotationService",["$rootScope","$http","commService","uiService",function(a,b,c,d){return{getVexPosition:function(a){return"Below"===a?Vex.Flow.Modifier.Position.BELOW:Vex.Flow.Modifier.Position.ABOVE},getBarHeight:function(){return 100},getStaffWidthFromRenderer:function(a){var b=$(a.ctx.paper.canvas),c=b.find("rect").first(),d=parseFloat(c.attr("width"));return d},getStaffHeight:function(a){var b=a.Measures,c=2,d=this.getBarHeight(),e=Math.ceil(b.length/c),f=d*e+20;return f},formatAndDrawTickables:function(a,b,c){if(c&&!(c.length<=0)){var d=b.measure,e=b.bar,f=d.TimeSignature?{num_beats:d.TimeSignature.BeatsInMeasure,beat_value:d.TimeSignature.BeatValue}:{num_beats:4,beat_value:4},g=new Vex.Flow.Voice(f).setMode(Vex.Flow.Voice.Mode.SOFT);g.addTickables(c),(new Vex.Flow.Formatter).joinVoices([g],{align_rests:!0}).formatToStave([g],e,{align_rests:!0}),g.setStave(e),g.draw(a,e)}},getNoteSelections:function(a,b,c){var d=[];if(b.NoteSelections)for(var e=0;e<b.NoteSelections.length;e++){var f=b.NoteSelections[e],g=f.NoteLocations[0],h=f.NoteLocations[f.NoteLocations.length-1],i=c[g.MeasureIndex].notes[g.ElementIndex],j=c[h.MeasureIndex].notes[h.ElementIndex];if(g.MeasureIndex!==h.MeasureIndex){d.push(new Vex.Flow.NoteSelection({first_note:i,notes:[i],color:f.TextColor,"stroke-width":2,isDotted:f.IsDotted},f.Text));for(var k=g.MeasureIndex+1;k<h.MeasureIndex;k++){var l=c[k].notes[0],m=c[k].notes[c[k].notes.length-1];d.push(new Vex.Flow.NoteSelection({first_note:l,last_note:m,notes:[l,m],color:f.TextColor,"stroke-width":2,isDotted:f.IsDotted,passthroughMeasure:!0},null))}d.push(new Vex.Flow.NoteSelection({last_note:j,notes:[j],color:f.TextColor,"stroke-width":2,isDotted:f.IsDotted},null))}else d.push(new Vex.Flow.NoteSelection({first_note:i,last_note:j,notes:[i,j],color:f.TextColor,"stroke-width":2,isDotted:f.IsDotted},f.Text))}return d},getNoteSections:function(a,b,c){var d=[];if(b.NoteSections)for(var e=0;e<b.NoteSections.length;e++){var f=b.NoteSections[e],g=f.NoteLocations[0],h=f.NoteLocations[f.NoteLocations.length-1],i=c[g.MeasureIndex].notes[g.ElementIndex],j=c[h.MeasureIndex].notes[h.ElementIndex];if(g.MeasureIndex!==h.MeasureIndex){d.push(new Vex.Flow.NoteSection({first_note:i,notes:[i],color:f.TextColor,"stroke-width":2,isDotted:f.IsDotted,displayAbove:f.DrawAbove},f.Text));for(var k=g.MeasureIndex+1;k<h.MeasureIndex;k++){var l=c[k].notes[0],m=c[k].notes[c[k].notes.length-1];d.push(new Vex.Flow.NoteSection({first_note:l,last_note:m,notes:[l,m],color:f.TextColor,"stroke-width":2,isDotted:f.IsDotted,displayAbove:f.DrawAbove,passthroughMeasure:!0},null))}d.push(new Vex.Flow.NoteSection({last_note:j,notes:[j],color:f.TextColor,"stroke-width":2,isDotted:f.IsDotted,displayAbove:f.DrawAbove},null))}else d.push(new Vex.Flow.NoteSection({first_note:i,last_note:j,notes:[i,j],color:f.TextColor,"stroke-width":2,isDotted:f.IsDotted,displayAbove:f.DrawAbove},f.Text))}return d},getTies:function(a,b){for(var c=[],d=0;d<a.Ties.length;d++){var e=a.Ties[d],f=e.NoteLocations[0],g=e.NoteLocations[e.NoteLocations.length-1],h=b[f.MeasureIndex].notes[f.ElementIndex],i=b[g.MeasureIndex].notes[g.ElementIndex];f.MeasureIndex!==g.MeasureIndex?(c.push(new Vex.Flow.StaveTie({first_note:h,first_indices:[f.StaffHeadIndex]})),c.push(new Vex.Flow.StaveTie({last_note:i,last_indices:[g.StaffHeadIndex]}))):c.push(new Vex.Flow.StaveTie({first_note:h,last_note:i,first_indices:[f.StaffHeadIndex],last_indices:[g.StaffHeadIndex]}))}return c},getBeams:function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=d.measure,f=(d.bar,0);f<e.Beams.length;f++){for(var g=e.Beams[f],h=[],i=0;i<g.NoteLocations.length;i++){var j=g.NoteLocations[i];h.push(a[j.MeasureIndex].notes[j.ElementIndex])}b.push(new Vex.Flow.Beam(h))}return b},getTuplets:function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=d.measure,f=0;f<e.Tuplets.length;f++){for(var g=e.Tuplets[f],h=[],i=0;i<g.NoteLocations.length;i++){var j=g.NoteLocations[i];h.push(a[j.MeasureIndex].notes[j.ElementIndex])}b.push(new Vex.Flow.Tuplet(h))}return b},renderNoteText:function(a,b,c){for(var d=0;d<c.length;d++)for(var e=c[d],f=e.measure,g=0;g<f.Notes.length;g++)for(var h=e.notes[g],i=this.getNoteTextCollection(b,d,g),j=0;j<i.length;j++){var k=i[j];h.addModifier(0,new Vex.Flow.NoteText({text:k.Text,textIndex:k.TextIndex,color:k.Color,position:this.getVexPosition(k.Position)}))}},getMeasureTextCollection:function(a,b){for(var c=[],d=0;d<a.MeasureText.length;d++){var e=a.MeasureText[d];e.Location.MeasureIndex===b&&c.push(e)}return c},getNoteTextCollection:function(a,b,c){for(var d=[],e=0;e<a.NoteText.length;e++){var f=a.NoteText[e];f.Location.MeasureIndex===b&&f.Location.ElementIndex===c&&d.push(f)}return d},getChordTextCollection:function(a,b,c){for(var d=[],e=0;e<a.ChordText.length;e++){var f=a.ChordText[e];f.Location.MeasureIndex===b&&f.Location.ElementIndex===c&&d.push(f)}return d},getNoteHighlights:function(a,b,c,d){for(var e=[],f=0;f<a.Highlights.length;f++){var g=a.Highlights[f];g.Location.MeasureIndex===b&&g.Location.ElementIndex===c&&g.NoteHeadIndex===d&&e.push(g)}return e},renderStaff:function(a,b,c){var e=a.Measures,f=2,g=this.getBarHeight(),h=this.getStaffHeight(a);c.height(h);var i,j=c[0];i="canvas"===j.tagName?new Vex.Flow.Renderer(j,Vex.Flow.Renderer.Backends.CANVAS):new Vex.Flow.Renderer(j,Vex.Flow.Renderer.Backends.RAPHAEL);var k=c.width(),l=i.getContext();l=d.createHiDefContext(k,h,null,j,l);for(var m,n,o,p=k/f,q=10,r=q,s=0,t=0,u=[],v=0,w=0,x=0;x<e.length;x++){t==f&&(t=0,r=q,s++),m=e[x];var y=s*g;if(n=new Vex.Flow.Stave(r,y,p),o={bar:n,measure:m,chords:[],notes:[],noteTextCollection:[]},0===t&&(n.addClef("Bass"===m.Clef?"bass":"treble"),m.KeySignature&&m.KeySignature.Key)){var z=new Vex.Flow.KeySignature(m.KeySignature.Key.Name+(m.KeySignature.IsMajor?"":"m"));z.addToStave(n)}0===x&&m.TimeSignature&&n.addTimeSignature(m.TimeSignature.BeatsInMeasure+"/"+m.TimeSignature.BeatValue),n.setContext(l).draw();var A;for(v=0;v<m.Chords.length;v++){var B=m.Chords[v],C=this.getChordTextCollection(b,x,v),D="";if(C.length>0)for(A=0;A<C.length;A++){var E=C[A];D+=E.Text}else D=B.IsRest||!b.DisplayMeasureChords?"":B.Name;var F=new Vex.Flow.TextNote({text:D,superscript:null,subscript:null,duration:B.NoteRhythm.DisplayNoteValueAsNumeric+(B.NoteRhythm.IsDotted?"d":"")}).setLine(2).setStave(n).setJustification(Vex.Flow.TextNote.Justification.CENTER);o.chords.push(F)}for(this.formatAndDrawTickables(l,o,o.chords),r+=p,v=0;v<m.Notes.length;v++){var G,H,I=m.Notes[v],J=I.NoteRhythm.DisplayNoteValueAsNumeric+(I.NoteRhythm.IsDotted?"d":"");if(I.IsRest)H={keys:["b/4"],duration:J+"r"};else{var K=[];for(A=0;A<I.NoteHeads.length;A++)G=I.NoteHeads[A],K.push(G.NameAndPitch.NoteName.Name.toLowerCase()+"/"+G.NameAndPitch.OctaveNumber);H={clef:n.clef,keys:K,duration:J,stem_direction:I.IsStemUp?1:-1}}for(var L=new Vex.Flow.StaveNote(H),M=0;M<I.NoteHeads.length;M++){G=I.NoteHeads[M];var N=this.getNoteHighlights(b,x,v,M);for(A=0;A<N.length;A++){var O=N[A];L.addModifier(M,new Vex.Flow.NoteHighlight({highlightIndex:O.HighlightIndex,color:O.Color}))}G.Accidentals&&L.addAccidental(M,new Vex.Flow.Accidental(G.Accidentals))}I.NoteRhythm.IsDotted&&L.addDotToAll(),o.notes.push(L)}u.push(o),t++}var P=this.getBeams(u),Q=this.getTuplets(u),R=this.getTies(a,u),S=this.getNoteSelections(a,b,u),T=this.getNoteSections(a,b,u);this.renderNoteText(l,b,u);var U=[];for(x=0;x<u.length;x++){o=u[x],m=o.measure,n=o.bar;var V=this.getMeasureTextCollection(b,x);for(w=0;w<V.length;w++){var W=V[w],X=new Vex.Flow.StaveText(W.Text,this.getVexPosition(W.Position),{shift_y:5});X.draw(n)}this.formatAndDrawTickables(l,o,o.notes)}for(x=0;x<U.length;x++)U[x].setContext(l).draw();for(x=0;x<P.length;x++)P[x].setContext(l).draw();for(x=0;x<Q.length;x++)Q[x].setContext(l).draw();for(x=0;x<R.length;x++)R[x].setContext(l).draw();for(x=0;x<S.length;x++)S[x].setContext(l).draw();for(x=0;x<T.length;x++)T[x].setContext(l).draw();return i}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryScaleService",["$rootScope","$http","commService","dmusiclibraryVirtualCowriterService","dmusiclibraryCommService",function(a,b,c,d,e){return{setModesAndInversionsFromService:function(a,b,c){a.Inversions=null,a.ParallelModes=null,a.RelativeModes=null;var d=a.ScaleChartResult?a.ScaleChartResult.TabScale:null;this.getModesAndInversions(a,{TabScale:d},function(c){a.Inversions=c.Inversions,a.ParallelModes=c.ParallelModes,a.RelativeModes=c.RelativeModes,b&&b(c)},c)},getModesAndInversions:function(a,b,c,f){e.postWithParams("scale",{RequestType:"ModesAndInversions",Scale:a,ParserOptions:d.getParserOptions(),ModesAndInversionsOptions:b},c,f)},getNotation:function(a,b,c){e.postWithParams("scale",{RequestType:"Notation",Scale:a},function(c){c.Staff&&c.Staff.Report&&c.Staff.Report.MeasureText&&c.Staff.Report.MeasureText.length>0&&(c.Staff.Report.MeasureText[0].Text=d.getScaleName(a,!0)),b&&b(c)},c)},setScaleChartFromService:function(a,b,c,d){var e={PreferredMaxFretsPerString:null};e=angular.extend(e,b),this.getScaleChart(a,e,function(b){a.ScaleChartResult=b.ScaleChartResult,c&&c(b)},d)},getScaleChart:function(a,b,c,f){e.postWithParams("scale",{RequestType:"ScaleChart",Scale:a,ScaleChartOptions:b,ParserOptions:d.getParserOptions()},function(b){b.ScaleChartResult.TabScale&&(b.ScaleChartResult.TabScale.MidiSound&&(a.MidiSound=b.ScaleChartResult.TabScale.MidiSound),a.IsAscending||(a.AscendingMidiSound=b.ScaleChartResult.TabScale.AscendingMidiSound)),c&&c(b)},f)},getChordSymbols:function(a,b,c,d){e.postWithParams("scale",{RequestType:"ChordSymbols",Scale:a,ChordSymbolOptions:b},c,d)},getScales:function(a,b,c){e.postWithParams("scale",{RequestType:"GetScales",GetScalesOptions:a},b,c)},setScaleOfBestFitForChordProgression:function(a,b,c,d){var e={Chords:a.Chords};e=angular.extend(e,b),this.getScaleOfBestFit(e,function(b){var d=b.ScaleOfBestFitResult.Scales;a.ScalesOfBestFit=d,c&&c(b)},d)},getScaleOfBestFit:function(a,b,c){var f={ConsiderExoticScales:!1,ConsiderModes:!0,FitByHarmony:!0,ChordSize:4,ChordDistances:3,ScalesToConsider:["Ionian","Melodic Minor","Harmonic Minor"]};f=angular.extend(f,a),e.postWithParams("scale",{RequestType:"ScaleOfBestFit",ScaleOfBestFitOptions:f,ParserOptions:d.getParserOptions()},b,c)},harmonize:function(a,b,c,f,g){e.postWithParams("scale",{RequestType:"Harmonize",Scale:a,ScaleName:b,HarmonizationOptions:c,ParserOptions:d.getParserOptions()},function(a){f&&f(a)},g)},setHarmonizedChords:function(a,b){var c=function(){};this.harmonize(a,b,{HarmonizeAtAllChromaticIndexes:!1,ChordDistances:3,ChordSize:3},function(b){a.HarmonizedChords.ThreeNoteChords=b.HarmonizedChords},c),this.harmonize(a,b,{HarmonizeAtAllChromaticIndexes:!0,ChordDistances:3,ChordSize:3},function(b){a.HarmonizedChords.ThreeNoteBorrowedChords=b.HarmonizedChords},c),this.harmonize(a,b,{HarmonizeAtAllChromaticIndexes:!1,ChordDistances:3,ChordSize:4},function(b){a.HarmonizedChords.FourNoteChords=b.HarmonizedChords},c),this.harmonize(a,b,{HarmonizeAtAllChromaticIndexes:!0,ChordDistances:3,ChordSize:4},function(b){a.HarmonizedChords.FourNoteBorrowedChords=b.HarmonizedChords},c)},fillScaleData:function(a){a.HarmonizedChords||(a.HarmonizedChords={ThreeNoteChords:null,ThreeNoteBorrowedChords:null,FourNoteChords:null,FourNoteBorrowedChords:null}),this.getNotation(a,function(b){a.Staff=b.Staff},function(){}),this.setModesAndInversionsFromService(a,function(){},function(){}),this.setScaleChartFromService(a,{PreferredMaxFretsPerString:null},function(){},function(){}),this.setHarmonizedChords(a)},fillChordProgressionData:function(a){this.setScaleOfBestFitForChordProgression(a)}}}]),angular.module("dmusiclibrary.Services").factory("dmusiclibraryVirtualCowriterService",["$rootScope","OPTIONS","commService","dmusiclibraryInstrumentService","accountService","dmusiclibraryCommService",function(a,b,c,d,e,f){return{lastCommand:null,commandElements:[],musicElements:[],isViewingMultipleMusicElements:function(){return this.musicElements&&this.musicElements.length>1},getParserOptions:function(){return{InstrumentParameter:d.instrument,ParserTabOptions:d.tabOptions}},parse:function(a,c,d){var e=this;f.postWithParams("parser",{RequestType:"Parse",Command:a,IsDebug:b.isDebug,ParserOptions:e.getParserOptions()},function(a){c&&c(a)},d)},getNoteNameString:function(a,b){for(var c="",d=0;d<a.length;d++){var e=a[d];c+=e.Name+(b?e.OctaveNumber:"")+(d+1>=a.length?"":", ")}return c},getNoteNumberNameString:function(a){for(var b="",c=0;c<a.length;c++){var d=a[c];b+=d.Name+(c+1>=a.length?"":", ")}return b},getScaleName:function(a,b){if(b&&a.IsNameUnknown)return this.getNoteNameString(a.NoteNamesWithinOctave);var c=a.Name;return a.IsNameUnknown&&(c="Unknown Scale"),c},showChordOnFretboard:function(b,c){var d={tabChord:b,scrollToFirstNote:!0,scrollToFretboard:c};a.$broadcast("setFretboardNotes",d),a.$emit("setFretboardNotes",d)}}}]);